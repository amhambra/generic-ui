import { ChangeDetectionStrategy, Component, ViewEncapsulation, inject } from '@angular/core';
import { StructureId } from '../../../../core/structure/structure-core/src/api/global/structure.id';
import { CompositionWarehouse } from '../../../../core/composition/src/api/composition.warehouse';
import { VerticalFormationWarehouse } from '../../../../core/structure/vertical-formation/src/api/vertical-formation.warehouse';
import { RowSelectionType } from '../../../../core/structure/formation/src/api/row-selected/row-selection';
import { CompositionId } from '../../../../core/composition/src/api/global/composition.id';
import { GuiState } from '../../../../feature/gui-angular/state/gui.state';
import { hermesMap } from '@generic-ui/hermes';
import { GuiComponent } from '../../../../feature/common/component';
import * as i0 from "@angular/core";
import * as i1 from "../../../../core/structure/filter/src/api/filter.warehouse";
import * as i2 from "../../../../core/structure/formation/src/api/formation.warehouse";
import * as i3 from "../../../../feature/composition/src/column/composition.template-warehouse";
import * as i4 from "@angular/common";
import * as i5 from "../../../../feature/gui-angular/template/let/gui.let.directive";
import * as i6 from "../../../../feature/gui-angular/template/style/gui.style.directive";
import * as i7 from "./column/structure-header-columns.component";
import * as i8 from "./group/structure-header-groups.component";
import * as i9 from "./filters/structure-header-filters.component";
export class StructureHeaderComponent extends GuiComponent {
    filterWarehouse;
    formationWarehouse;
    compositionTemplateWarehouse;
    state = inject((GuiState));
    compositionWarehouse = inject(CompositionWarehouse);
    structureId = inject(StructureId);
    compositionId = inject(CompositionId);
    verticalFormationWarehouse = inject(VerticalFormationWarehouse);
    state$ = this.state.select();
    width$ = this.compositionWarehouse.onContainerWidth(this.compositionId)
        .pipe(hermesMap(width => {
        return {
            width
        };
    }));
    filterHeaderHeight$ = this.verticalFormationWarehouse.onRowHeight(this.structureId)
        .pipe(hermesMap((rowHeight) => {
        const headerHeight = +(rowHeight) + 2;
        return {
            height: headerHeight
        };
    }));
    constructor(elementRef, filterWarehouse, formationWarehouse, compositionTemplateWarehouse) {
        super(elementRef);
        this.filterWarehouse = filterWarehouse;
        this.formationWarehouse = formationWarehouse;
        this.compositionTemplateWarehouse = compositionTemplateWarehouse;
        this.state.setValue({
            headerColumns: [],
            filterRowEnabled: false,
            showGroups: false
        });
        this.state.connect('showSelection', this.selectShowSelection());
        this.state.connect('headerColumns', this.compositionTemplateWarehouse.onHeaderCols(this.compositionId));
        this.state.connect('filterRowEnabled', this.filterWarehouse.onFilteringEnabled(this.structureId));
        this.state.connect('showGroups', this.selectShowGroups());
        this.state.connect('groups', this.selectGroups());
    }
    getSelectorName() {
        return 'gui-structure-header';
    }
    selectGroups() {
        return this.compositionWarehouse
            .onGroups(this.compositionId)
            .pipe(hermesMap((collection) => collection.getGroups()));
    }
    selectShowGroups() {
        return this.compositionWarehouse
            .onGroups(this.compositionId)
            .pipe(hermesMap((collection) => collection.isVisible()));
    }
    selectShowSelection() {
        return this.formationWarehouse
            .onType(this.structureId)
            .pipe(hermesMap((type) => {
            return type === RowSelectionType.CHECKBOX || type === RowSelectionType.RADIO;
        }));
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.2", ngImport: i0, type: StructureHeaderComponent, deps: [{ token: i0.ElementRef }, { token: i1.FilterWarehouse }, { token: i2.FormationWarehouse }, { token: i3.CompositionTemplateWarehouse }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.0.2", type: StructureHeaderComponent, selector: "div[gui-structure-header]", providers: [
            GuiState
        ], usesInheritance: true, ngImport: i0, template: "<ng-container *guiLet=\"state$; let localState\">\n\t<div *ngIf=\"localState.showGroups\"\n\t\t [checkboxSelection]=\"localState.showSelection\"\n\t\t [groups]=\"localState.groups\"\n\t\t class=\"gui-header\"\n\t\t gui-structure-header-groups>\n\t</div>\n</ng-container>\n\n<div *guiLet=\"state$; let localState\"\n\t [columns]=\"localState.headerColumns\"\n\t [guiStyle]=\"width$\"\n\t [showSelection]=\"localState.showSelection\"\n\t class=\"gui-header\"\n\t gui-structure-header-columns>\n</div>\n\n<ng-container *guiLet=\"state$; let localState\">\n\t<div *ngIf=\"localState.filterRowEnabled\"\n\t\t [columns]=\"localState.headerColumns\"\n\t\t [guiStyle]=\"filterHeaderHeight$\"\n\t\t class=\"gui-header\"\n\t\t gui-structure-header-filters>\n\t</div>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i5.GuiLetDirective, selector: "[guiLet]", inputs: ["guiLet"] }, { kind: "directive", type: i6.GuiStyleDirective, selector: "[guiStyle]", inputs: ["guiStyle"] }, { kind: "component", type: i7.StructureHeaderColumnsComponent, selector: "div[gui-structure-header-columns][columns]", inputs: ["columns", "showSelection"] }, { kind: "component", type: i8.StructureHeaderGroupsComponent, selector: "div[gui-structure-header-groups][groups][checkboxSelection]", inputs: ["groups", "showGroups", "checkboxSelection"] }, { kind: "component", type: i9.StructureHeaderFiltersComponent, selector: "div[gui-structure-header-filters][columns]", inputs: ["columns"], outputs: ["closed"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.2", ngImport: i0, type: StructureHeaderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'div[gui-structure-header]', changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, providers: [
                        GuiState
                    ], template: "<ng-container *guiLet=\"state$; let localState\">\n\t<div *ngIf=\"localState.showGroups\"\n\t\t [checkboxSelection]=\"localState.showSelection\"\n\t\t [groups]=\"localState.groups\"\n\t\t class=\"gui-header\"\n\t\t gui-structure-header-groups>\n\t</div>\n</ng-container>\n\n<div *guiLet=\"state$; let localState\"\n\t [columns]=\"localState.headerColumns\"\n\t [guiStyle]=\"width$\"\n\t [showSelection]=\"localState.showSelection\"\n\t class=\"gui-header\"\n\t gui-structure-header-columns>\n</div>\n\n<ng-container *guiLet=\"state$; let localState\">\n\t<div *ngIf=\"localState.filterRowEnabled\"\n\t\t [columns]=\"localState.headerColumns\"\n\t\t [guiStyle]=\"filterHeaderHeight$\"\n\t\t class=\"gui-header\"\n\t\t gui-structure-header-filters>\n\t</div>\n</ng-container>\n" }]
        }], ctorParameters: () => [{ type: i0.ElementRef }, { type: i1.FilterWarehouse }, { type: i2.FormationWarehouse }, { type: i3.CompositionTemplateWarehouse }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RydWN0dXJlLWhlYWRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9idWlsZC1jbGkvcHJvamVjdHMvbmd4LWdyaWQvc3JjL2ZlYXR1cmUtdmlldy9ncmlkLXZpZXcvc3JjL2hlYWRlci9zdHJ1Y3R1cmUtaGVhZGVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2J1aWxkLWNsaS9wcm9qZWN0cy9uZ3gtZ3JpZC9zcmMvZmVhdHVyZS12aWV3L2dyaWQtdmlldy9zcmMvaGVhZGVyL3N0cnVjdHVyZS1oZWFkZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFNBQVMsRUFBYyxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHVFQUF1RSxDQUFDO0FBRXBHLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDREQUE0RCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLG9GQUFvRixDQUFDO0FBQ2hJLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlFQUF5RSxDQUFDO0FBRTNHLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0REFBNEQsQ0FBQztBQUszRixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saURBQWlELENBQUM7QUFDM0UsT0FBTyxFQUFFLFNBQVMsRUFBb0IsTUFBTSxvQkFBb0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0NBQXNDLENBQUM7Ozs7Ozs7Ozs7O0FBeUJwRSxNQUFNLE9BQU8sd0JBQXlCLFNBQVEsWUFBWTtJQWtDdkM7SUFDQTtJQUNBO0lBbENELEtBQUssR0FBRyxNQUFNLENBQUMsQ0FBQSxRQUF1QyxDQUFBLENBQUMsQ0FBQztJQUN4RCxvQkFBb0IsR0FBRyxNQUFNLENB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QyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQ3hCLElBQUksQ0FDSixTQUFTLENBQUMsQ0FBQyxJQUFzQixFQUFFLEVBQUU7WUFDcEMsT0FBTyxJQUFJLEtBQUssZ0JBQWdCLENBQUMsUUFBUSxJQUFJLElBQUksS0FBSyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUM7UUFDOUUsQ0FBQyxDQUFDLENBQ0YsQ0FBQztJQUNSLENBQUM7dUdBakZXLHdCQUF3QjsyRkFBeEIsd0JBQXdCLG9EQUp6QjtZQUNWLFFBQVE7U0FDUixpRENyQ0YseXdCQXlCQTs7MkZEY2Esd0JBQXdCO2tCQVRwQyxTQUFTOytCQUNDLDJCQUEyQixtQkFFcEIsdUJBQXVCLENBQUMsTUFBTSxpQkFDaEMsaUJBQWlCLENBQUMsSUFBSSxhQUMxQjt3QkFDVixRQUFRO3FCQUNSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgRWxlbWVudFJlZiwgVmlld0VuY2Fwc3VsYXRpb24sIGluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3RydWN0dXJlSWQgfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL3N0cnVjdHVyZS9zdHJ1Y3R1cmUtY29yZS9zcmMvYXBpL2dsb2JhbC9zdHJ1Y3R1cmUuaWQnO1xuaW1wb3J0IHsgRmlsdGVyV2FyZWhvdXNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9zdHJ1Y3R1cmUvZmlsdGVyL3NyYy9hcGkvZmlsdGVyLndhcmVob3VzZSc7XG5pbXBvcnQgeyBDb21wb3NpdGlvbldhcmVob3VzZSB9IGZyb20gJy4uLy4uLy4uLy4uL2NvcmUvY29tcG9zaXRpb24vc3JjL2FwaS9jb21wb3NpdGlvbi53YXJlaG91c2UnO1xuaW1wb3J0IHsgVmVydGljYWxGb3JtYXRpb25XYXJlaG91c2UgfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL3N0cnVjdHVyZS92ZXJ0aWNhbC1mb3JtYXRpb24vc3JjL2FwaS92ZXJ0aWNhbC1mb3JtYXRpb24ud2FyZWhvdXNlJztcbmltcG9ydCB7IFJvd1NlbGVjdGlvblR5cGUgfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL3N0cnVjdHVyZS9mb3JtYXRpb24vc3JjL2FwaS9yb3ctc2VsZWN0ZWQvcm93LXNlbGVjdGlvbic7XG5pbXBvcnQgeyBHcm91cCB9IGZyb20gJy4uLy4uLy4uLy4uL2NvcmUvY29tcG9zaXRpb24vc3JjL2FwaS9ncm91cC9ncm91cCc7XG5pbXBvcnQgeyBDb21wb3NpdGlvbklkIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9jb21wb3NpdGlvbi9zcmMvYXBpL2dsb2JhbC9jb21wb3NpdGlvbi5pZCc7XG5pbXBvcnQgeyBHcm91cENvbGxlY3Rpb24gfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL2NvbXBvc2l0aW9uL3NyYy9hcGkvZ3JvdXAvZ3JvdXAuY29sbGVjdGlvbic7XG5pbXBvcnQgeyBDb21wb3NpdGlvblRlbXBsYXRlV2FyZWhvdXNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vZmVhdHVyZS9jb21wb3NpdGlvbi9zcmMvY29sdW1uL2NvbXBvc2l0aW9uLnRlbXBsYXRlLXdhcmVob3VzZSc7XG5pbXBvcnQgeyBDb21wb3NpdGlvblRlbXBsYXRlTW9kZWwgfSBmcm9tICcuLi8uLi8uLi8uLi9mZWF0dXJlL2NvbXBvc2l0aW9uL3NyYy9jb2x1bW4vY29tcG9zaXRpb24udGVtcGxhdGUubW9kZWwnO1xuaW1wb3J0IHsgRm9ybWF0aW9uV2FyZWhvdXNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9zdHJ1Y3R1cmUvZm9ybWF0aW9uL3NyYy9hcGkvZm9ybWF0aW9uLndhcmVob3VzZSc7XG5pbXBvcnQgeyBHdWlTdGF0ZSB9IGZyb20gJy4uLy4uLy4uLy4uL2ZlYXR1cmUvZ3VpLWFuZ3VsYXIvc3RhdGUvZ3VpLnN0YXRlJztcbmltcG9ydCB7IGhlcm1lc01hcCwgSGVybWVzT2JzZXJ2YWJsZSB9IGZyb20gJ0BnZW5lcmljLXVpL2hlcm1lcyc7XG5pbXBvcnQgeyBHdWlDb21wb25lbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9mZWF0dXJlL2NvbW1vbi9jb21wb25lbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN0cnVjdHVyZUhlYWRlckNvbXBvbmVudFN0YXRlIHtcblxuXHRoZWFkZXJDb2x1bW5zOiBSZWFkb25seUFycmF5PENvbXBvc2l0aW9uVGVtcGxhdGVNb2RlbD47XG5cblx0ZmlsdGVyUm93RW5hYmxlZDogYm9vbGVhbjtcblxuXHRncm91cHM6IEFycmF5PEdyb3VwPjtcblxuXHRzaG93R3JvdXBzOiBib29sZWFuO1xuXG5cdHNob3dTZWxlY3Rpb246IGJvb2xlYW47XG5cbn1cblxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiAnZGl2W2d1aS1zdHJ1Y3R1cmUtaGVhZGVyXScsXG5cdHRlbXBsYXRlVXJsOiAnLi9zdHJ1Y3R1cmUtaGVhZGVyLmNvbXBvbmVudC5odG1sJyxcblx0Y2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG5cdGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG5cdHByb3ZpZGVyczogW1xuXHRcdEd1aVN0YXRlXG5cdF1cbn0pXG5leHBvcnQgY2xhc3MgU3RydWN0dXJlSGVhZGVyQ29tcG9uZW50IGV4dGVuZHMgR3VpQ29tcG9uZW50IHtcblxuXHRwcml2YXRlIHJlYWRvbmx5IHN0YXRlID0gaW5qZWN0KEd1aVN0YXRlPFN0cnVjdHVyZUhlYWRlckNvbXBvbmVudFN0YXRlPik7XG5cdHByaXZhdGUgcmVhZG9ubHkgY29tcG9zaXRpb25XYXJlaG91c2UgPSBpbmplY3QoQ29tcG9zaXRpb25XYXJlaG91c2UpO1xuXHRwcml2YXRlIHJlYWRvbmx5IHN0cnVjdHVyZUlkID0gaW5qZWN0KFN0cnVjdHVyZUlkKTtcblx0cHJpdmF0ZSByZWFkb25seSBjb21wb3NpdGlvbklkID0gaW5qZWN0KENvbXBvc2l0aW9uSWQpO1xuXHRwcml2YXRlIHJlYWRvbmx5IHZlcnRpY2FsRm9ybWF0aW9uV2FyZWhvdXNlID0gaW5qZWN0KFZlcnRpY2FsRm9ybWF0aW9uV2FyZWhvdXNlKTtcblxuXHRyZWFkb25seSBzdGF0ZSQgPSB0aGlzLnN0YXRlLnNlbGVjdCgpO1xuXG5cdHJlYWRvbmx5IHdpZHRoJCA9IHRoaXMuY29tcG9zaXRpb25XYXJlaG91c2Uub25Db250YWluZXJXaWR0aCh0aGlzLmNvbXBvc2l0aW9uSWQpXG5cdFx0XHRcdFx0XHQgIC5waXBlKFxuXHRcdFx0XHRcdFx0XHQgIGhlcm1lc01hcCh3aWR0aCA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0ICByZXR1cm4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0ICB3aWR0aFxuXHRcdFx0XHRcdFx0XHRcdCAgfTtcblx0XHRcdFx0XHRcdFx0ICB9KVxuXHRcdFx0XHRcdFx0ICApO1xuXG5cblx0cmVhZG9ubHkgZmlsdGVySGVhZGVySGVpZ2h0JCA9IHRoaXMudmVydGljYWxGb3JtYXRpb25XYXJlaG91c2Uub25Sb3dIZWlnaHQodGhpcy5zdHJ1Y3R1cmVJZClcblx0XHRcdFx0XHRcdFx0XHRcdCAgIC5waXBlKFxuXHRcdFx0XHRcdFx0XHRcdFx0XHQgICBoZXJtZXNNYXAoKHJvd0hlaWdodDogbnVtYmVyKSA9PiB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgICBjb25zdCBoZWFkZXJIZWlnaHQgPSArKHJvd0hlaWdodCkgKyAyO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ICAgcmV0dXJuIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCAgIGhlaWdodDogaGVhZGVySGVpZ2h0XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ICAgfTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ICAgfSlcblx0XHRcdFx0XHRcdFx0XHRcdCAgICk7XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0ZWxlbWVudFJlZjogRWxlbWVudFJlZixcblx0XHRwcml2YXRlIHJlYWRvbmx5IGZpbHRlcldhcmVob3VzZTogRmlsdGVyV2FyZWhvdXNlLFxuXHRcdHByaXZhdGUgcmVhZG9ubHkgZm9ybWF0aW9uV2FyZWhvdXNlOiBGb3JtYXRpb25XYXJlaG91c2UsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBjb21wb3NpdGlvblRlbXBsYXRlV2FyZWhvdXNlOiBDb21wb3NpdGlvblRlbXBsYXRlV2FyZWhvdXNlXG5cdCkge1xuXHRcdHN1cGVyKGVsZW1lbnRSZWYpO1xuXG5cdFx0dGhpcy5zdGF0ZS5zZXRWYWx1ZSh7XG5cdFx0XHRoZWFkZXJDb2x1bW5zOiBbXSxcblx0XHRcdGZpbHRlclJvd0VuYWJsZWQ6IGZhbHNlLFxuXHRcdFx0c2hvd0dyb3VwczogZmFsc2Vcblx0XHR9KTtcblxuXHRcdHRoaXMuc3RhdGUuY29ubmVjdCgnc2hvd1NlbGVjdGlvbicsIHRoaXMuc2VsZWN0U2hvd1NlbGVjdGlvbigpKTtcblx0XHR0aGlzLnN0YXRlLmNvbm5lY3QoJ2hlYWRlckNvbHVtbnMnLCB0aGlzLmNvbXBvc2l0aW9uVGVtcGxhdGVXYXJlaG91c2Uub25IZWFkZXJDb2xzKHRoaXMuY29tcG9zaXRpb25JZCkpO1xuXHRcdHRoaXMuc3RhdGUuY29ubmVjdCgnZmlsdGVyUm93RW5hYmxlZCcsIHRoaXMuZmlsdGVyV2FyZWhvdXNlLm9uRmlsdGVyaW5nRW5hYmxlZCh0aGlzLnN0cnVjdHVyZUlkKSk7XG5cdFx0dGhpcy5zdGF0ZS5jb25uZWN0KCdzaG93R3JvdXBzJywgdGhpcy5zZWxlY3RTaG93R3JvdXBzKCkpO1xuXHRcdHRoaXMuc3RhdGUuY29ubmVjdCgnZ3JvdXBzJywgdGhpcy5zZWxlY3RHcm91cHMoKSk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgZ2V0U2VsZWN0b3JOYW1lKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuICdndWktc3RydWN0dXJlLWhlYWRlcic7XG5cdH1cblxuXHRwcml2YXRlIHNlbGVjdEdyb3VwcygpOiBIZXJtZXNPYnNlcnZhYmxlPEFycmF5PEdyb3VwPj4ge1xuXHRcdHJldHVybiB0aGlzLmNvbXBvc2l0aW9uV2FyZWhvdXNlXG5cdFx0XHRcdCAgIC5vbkdyb3Vwcyh0aGlzLmNvbXBvc2l0aW9uSWQpXG5cdFx0XHRcdCAgIC5waXBlKFxuXHRcdFx0XHRcdCAgIGhlcm1lc01hcCgoY29sbGVjdGlvbjogR3JvdXBDb2xsZWN0aW9uKSA9PiBjb2xsZWN0aW9uLmdldEdyb3VwcygpKVxuXHRcdFx0XHQgICApO1xuXHR9XG5cblx0cHJpdmF0ZSBzZWxlY3RTaG93R3JvdXBzKCkge1xuXHRcdHJldHVybiB0aGlzLmNvbXBvc2l0aW9uV2FyZWhvdXNlXG5cdFx0XHRcdCAgIC5vbkdyb3Vwcyh0aGlzLmNvbXBvc2l0aW9uSWQpXG5cdFx0XHRcdCAgIC5waXBlKFxuXHRcdFx0XHRcdCAgIGhlcm1lc01hcCgoY29sbGVjdGlvbjogR3JvdXBDb2xsZWN0aW9uKSA9PiBjb2xsZWN0aW9uLmlzVmlzaWJsZSgpKVxuXHRcdFx0XHQgICApO1xuXHR9XG5cblx0cHJpdmF0ZSBzZWxlY3RTaG93U2VsZWN0aW9uKCk6IEhlcm1lc09ic2VydmFibGU8Ym9vbGVhbj4ge1xuXHRcdHJldHVybiB0aGlzLmZvcm1hdGlvbldhcmVob3VzZVxuXHRcdFx0XHQgICAub25UeXBlKHRoaXMuc3RydWN0dXJlSWQpXG5cdFx0XHRcdCAgIC5waXBlKFxuXHRcdFx0XHRcdCAgIGhlcm1lc01hcCgodHlwZTogUm93U2VsZWN0aW9uVHlwZSkgPT4ge1xuXHRcdFx0XHRcdFx0ICAgcmV0dXJuIHR5cGUgPT09IFJvd1NlbGVjdGlvblR5cGUuQ0hFQ0tCT1ggfHwgdHlwZSA9PT0gUm93U2VsZWN0aW9uVHlwZS5SQURJTztcblx0XHRcdFx0XHQgICB9KVxuXHRcdFx0XHQgICApO1xuXHR9XG5cbn1cbiIsIjxuZy1jb250YWluZXIgKmd1aUxldD1cInN0YXRlJDsgbGV0IGxvY2FsU3RhdGVcIj5cblx0PGRpdiAqbmdJZj1cImxvY2FsU3RhdGUuc2hvd0dyb3Vwc1wiXG5cdFx0IFtjaGVja2JveFNlbGVjdGlvbl09XCJsb2NhbFN0YXRlLnNob3dTZWxlY3Rpb25cIlxuXHRcdCBbZ3JvdXBzXT1cImxvY2FsU3RhdGUuZ3JvdXBzXCJcblx0XHQgY2xhc3M9XCJndWktaGVhZGVyXCJcblx0XHQgZ3VpLXN0cnVjdHVyZS1oZWFkZXItZ3JvdXBzPlxuXHQ8L2Rpdj5cbjwvbmctY29udGFpbmVyPlxuXG48ZGl2ICpndWlMZXQ9XCJzdGF0ZSQ7IGxldCBsb2NhbFN0YXRlXCJcblx0IFtjb2x1bW5zXT1cImxvY2FsU3RhdGUuaGVhZGVyQ29sdW1uc1wiXG5cdCBbZ3VpU3R5bGVdPVwid2lkdGgkXCJcblx0IFtzaG93U2VsZWN0aW9uXT1cImxvY2FsU3RhdGUuc2hvd1NlbGVjdGlvblwiXG5cdCBjbGFzcz1cImd1aS1oZWFkZXJcIlxuXHQgZ3VpLXN0cnVjdHVyZS1oZWFkZXItY29sdW1ucz5cbjwvZGl2PlxuXG48bmctY29udGFpbmVyICpndWlMZXQ9XCJzdGF0ZSQ7IGxldCBsb2NhbFN0YXRlXCI+XG5cdDxkaXYgKm5nSWY9XCJsb2NhbFN0YXRlLmZpbHRlclJvd0VuYWJsZWRcIlxuXHRcdCBbY29sdW1uc109XCJsb2NhbFN0YXRlLmhlYWRlckNvbHVtbnNcIlxuXHRcdCBbZ3VpU3R5bGVdPVwiZmlsdGVySGVhZGVySGVpZ2h0JFwiXG5cdFx0IGNsYXNzPVwiZ3VpLWhlYWRlclwiXG5cdFx0IGd1aS1zdHJ1Y3R1cmUtaGVhZGVyLWZpbHRlcnM+XG5cdDwvZGl2PlxuPC9uZy1jb250YWluZXI+XG4iXX0=