import { KeyMap } from '@generic-ui/hermes';
import { UniqueValueCollection } from './unique-value-collection';
export class UniqueFilterManager {
    constructor() {
        this.uniqueValueMap = new KeyMap();
    }
    calculate(entities, field) {
        const fieldId = field.getId();
        const optUVM = this.uniqueValueMap.get(fieldId);
        optUVM.ifEmpty(() => {
            const set = new Set();
            for (const entity of entities) {
                set.add(field.getValue(entity));
            }
            // sort
            const sortedValues = Array.from(set.values()).sort((a, b) => {
                return field.getField().sort(a, b);
            });
            const uvc = new UniqueValueCollection(sortedValues, field);
            this.uniqueValueMap.set(field.getId(), uvc);
        });
    }
    calculateAll(entities, fields) {
        for (const field of fields) {
            this.calculate(entities, field);
        }
    }
    filterAll(entities, fields) {
        let values = entities;
        for (const field of fields) {
            values = this.filter(values, field);
        }
        return values;
    }
    filter(entities, field) {
        let values = [];
        this.uniqueValueMap
            .get(field.getId())
            .ifPresent((uvc) => {
            if (uvc.isAllSelected()) {
                values = entities;
            }
            else if (uvc.isAllDisabled()) {
                values = [];
            }
            else {
                values = entities.filter((itemEntity) => {
                    for (const notSelectedValue of uvc.getNotSelected()) {
                        if (field.getField().equals(itemEntity, notSelectedValue.getValue())) {
                            return false;
                        }
                    }
                    return true;
                });
            }
        });
        return values;
    }
    selectAll(fieldId) {
        this.uniqueValueMap
            .get(fieldId)
            .ifPresent((uvc) => {
            uvc.selectAll();
        });
    }
    select(fieldId, uniqueValueId) {
        this.uniqueValueMap
            .get(fieldId)
            .ifPresent((uvc) => {
            uvc.select(uniqueValueId);
        });
    }
    unselectAll(fieldId) {
        this.uniqueValueMap
            .get(fieldId)
            .ifPresent((uvc) => {
            uvc.unselectAll();
        });
    }
    unselect(fieldId, uniqueValueId) {
        this.uniqueValueMap
            .get(fieldId)
            .ifPresent((uvc) => {
            uvc.unselect(uniqueValueId);
        });
    }
    getAll(fields) {
        const map = new Map();
        for (const field of fields) {
            this.getValues(field)
                .ifPresent((v) => {
                map.set(field.getId().toString(), v);
            });
        }
        return map;
    }
    getValues(field) {
        return this.uniqueValueMap
            .get(field.getId())
            .map((uvc) => {
            return uvc.getAll();
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLWZpbHRlci1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vYnVpbGQtY2xpL3Byb2plY3RzL25neC1ncmlkL3NyYy9zdHJ1Y3R1cmUvZmlsdGVyL2NvcmUvZG9tYWluL3VuaXF1ZS91bmlxdWUtZmlsdGVyLW1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBWSxNQUFNLG9CQUFvQixDQUFDO0FBS3RELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBS2xFLE1BQU0sT0FBTyxtQkFBbUI7SUFBaEM7UUFFa0IsbUJBQWMsR0FBRyxJQUFJLE1BQU0sRUFBa0MsQ0FBQztJQTBJaEYsQ0FBQztJQXhJQSxTQUFTLENBQUMsUUFBaUMsRUFBRSxLQUFZO1FBRXhELE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU5QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVoRCxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUVuQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBRXRCLEtBQUssTUFBTSxNQUFNLElBQUksUUFBUSxFQUFFO2dCQUM5QixHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzthQUNoQztZQUVELE9BQU87WUFDUCxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsRUFBRTtnQkFDckUsT0FBUSxLQUFhLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FB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R0FBRyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBb0I7UUFFMUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUV0QixLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBRTtZQUUzQixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztpQkFDbkIsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxPQUFPLEdBQUcsQ0FBQztJQUNaLENBQUM7SUFFRCxTQUFTLENBQUMsS0FBWTtRQUVyQixPQUFPLElBQUksQ0FBQyxjQUFjO2FBQ3BCLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDbEIsR0FBRyxDQUFDLENBQUMsR0FBMEIsRUFBRSxFQUFFO1lBQ25DLE9BQU8sR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3JCLENBQUMsQ0FBQyxDQUFDO0lBQ1QsQ0FBQztDQUVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgS2V5TWFwLCBPcHRpb25hbCB9IGZyb20gJ0BnZW5lcmljLXVpL2hlcm1lcyc7XG5cbmltcG9ydCB7IEZpZWxkSWQgfSBmcm9tICcuLi8uLi8uLi8uLi9maWVsZC9jb3JlL2RvbWFpbi9maWVsZC9maWVsZC5pZCc7XG5pbXBvcnQgeyBPcmlnaW5JdGVtRW50aXR5IH0gZnJvbSAnLi4vLi4vLi4vLi4vc291cmNlL2NvcmUvZG9tYWluL29yaWdpbi9vcmlnaW4taXRlbS1lbnRpdHknO1xuaW1wb3J0IHsgRmllbGQgfSBmcm9tICcuLi8uLi8uLi8uLi9maWVsZC9jb3JlL2RvbWFpbi9maWVsZC9maWVsZCc7XG5pbXBvcnQgeyBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24gfSBmcm9tICcuL3VuaXF1ZS12YWx1ZS1jb2xsZWN0aW9uJztcbmltcG9ydCB7IFVuaXF1ZVZhbHVlIH0gZnJvbSAnLi91bmlxdWUtdmFsdWUnO1xuaW1wb3J0IHsgVW5pcXVlVmFsdWVJZCB9IGZyb20gJy4vdW5pcXVlLXZhbHVlLWlkJztcblxuXG5leHBvcnQgY2xhc3MgVW5pcXVlRmlsdGVyTWFuYWdlciB7XG5cblx0cHJpdmF0ZSByZWFkb25seSB1bmlxdWVWYWx1ZU1hcCA9IG5ldyBLZXlNYXA8RmllbGRJZCwgVW5pcXVlVmFsdWVDb2xsZWN0aW9uPigpO1xuXG5cdGNhbGN1bGF0ZShlbnRpdGllczogQXJyYXk8T3JpZ2luSXRlbUVudGl0eT4sIGZpZWxkOiBGaWVsZCk6IHZvaWQge1xuXG5cdFx0Y29uc3QgZmllbGRJZCA9IGZpZWxkLmdldElkKCk7XG5cblx0XHRjb25zdCBvcHRVVk0gPSB0aGlzLnVuaXF1ZVZhbHVlTWFwLmdldChmaWVsZElkKTtcblxuXHRcdG9wdFVWTS5pZkVtcHR5KCgpID0+IHtcblxuXHRcdFx0Y29uc3Qgc2V0ID0gbmV3IFNldCgpO1xuXG5cdFx0XHRmb3IgKGNvbnN0IGVudGl0eSBvZiBlbnRpdGllcykge1xuXHRcdFx0XHRzZXQuYWRkKGZpZWxkLmdldFZhbHVlKGVudGl0eSkpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzb3J0XG5cdFx0XHRjb25zdCBzb3J0ZWRWYWx1ZXMgPSBBcnJheS5mcm9tKHNldC52YWx1ZXMoKSkuc29ydCgoYTogYW55LCBiOiBhbnkpID0+IHtcblx0XHRcdFx0cmV0dXJuIChmaWVsZCBhcyBhbnkpLmdldEZpZWxkKCkuc29ydChhLCBiKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjb25zdCB1dmMgPSBuZXcgVW5pcXVlVmFsdWVDb2xsZWN0aW9uKHNvcnRlZFZhbHVlcywgZmllbGQpO1xuXG5cdFx0XHR0aGlzLnVuaXF1ZVZhbHVlTWFwLnNldChmaWVsZC5nZXRJZCgpLCB1dmMpO1xuXHRcdH0pO1xuXG5cdH1cblxuXHRjYWxjdWxhdGVBbGwoZW50aXRpZXM6IEFycmF5PE9yaWdpbkl0ZW1FbnRpdHk+LCBmaWVsZHM6IEFycmF5PEZpZWxkPik6IHZvaWQge1xuXHRcdGZvciAoY29uc3QgZmllbGQgb2YgZmllbGRzKSB7XG5cdFx0XHR0aGlzLmNhbGN1bGF0ZShlbnRpdGllcywgZmllbGQpO1xuXHRcdH1cblx0fVxuXG5cdGZpbHRlckFsbChlbnRpdGllczogQXJyYXk8T3JpZ2luSXRlbUVudGl0eT4sIGZpZWxkczogQXJyYXk8RmllbGQ+KTogQXJyYXk8T3JpZ2luSXRlbUVudGl0eT4ge1xuXG5cdFx0bGV0IHZhbHVlczogQXJyYXk8T3JpZ2luSXRlbUVudGl0eT4gPSBlbnRpdGllcztcblxuXHRcdGZvciAoY29uc3QgZmllbGQgb2YgZmllbGRzKSB7XG5cblx0XHRcdHZhbHVlcyA9IHRoaXMuZmlsdGVyKHZhbHVlcywgZmllbGQpO1xuXHRcdH1cblxuXHRcdHJldHVybiB2YWx1ZXM7XG5cdH1cblxuXHRmaWx0ZXIoZW50aXRpZXM6IEFycmF5PE9yaWdpbkl0ZW1FbnRpdHk+LCBmaWVsZDogRmllbGQpOiBBcnJheTxPcmlnaW5JdGVtRW50aXR5PiB7XG5cblx0XHRsZXQgdmFsdWVzOiBBcnJheTxPcmlnaW5JdGVtRW50aXR5PiA9IFtdO1xuXG5cdFx0dGhpcy51bmlxdWVWYWx1ZU1hcFxuXHRcdFx0LmdldChmaWVsZC5nZXRJZCgpKVxuXHRcdFx0LmlmUHJlc2VudCgodXZjOiBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24pID0+IHtcblxuXHRcdFx0XHRpZiAodXZjLmlzQWxsU2VsZWN0ZWQoKSkge1xuXHRcdFx0XHRcdHZhbHVlcyA9IGVudGl0aWVzO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHV2Yy5pc0FsbERpc2FibGVkKCkpIHtcblx0XHRcdFx0XHR2YWx1ZXMgPSBbXTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHZhbHVlcyA9IGVudGl0aWVzLmZpbHRlcigoaXRlbUVudGl0eTogT3JpZ2luSXRlbUVudGl0eSkgPT4ge1xuXG5cdFx0XHRcdFx0XHRmb3IgKGNvbnN0IG5vdFNlbGVjdGVkVmFsdWUgb2YgdXZjLmdldE5vdFNlbGVjdGVkKCkpIHtcblxuXHRcdFx0XHRcdFx0XHRpZiAoKGZpZWxkLmdldEZpZWxkKCkgYXMgYW55KS5lcXVhbHMoaXRlbUVudGl0eSwgKG5vdFNlbGVjdGVkVmFsdWUgYXMgYW55KS5nZXRWYWx1ZSgpKSkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9KTtcblxuXHRcdHJldHVybiB2YWx1ZXM7XG5cdH1cblxuXHRzZWxlY3RBbGwoZmllbGRJZDogRmllbGRJZCk6IHZvaWQge1xuXG5cdFx0dGhpcy51bmlxdWVWYWx1ZU1hcFxuXHRcdFx0LmdldChmaWVsZElkKVxuXHRcdFx0LmlmUHJlc2VudCgodXZjOiBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24pID0+IHtcblx0XHRcdFx0dXZjLnNlbGVjdEFsbCgpO1xuXHRcdFx0fSk7XG5cdH1cblxuXHRzZWxlY3QoZmllbGRJZDogRmllbGRJZCwgdW5pcXVlVmFsdWVJZDogVW5pcXVlVmFsdWVJZCk6IHZvaWQge1xuXG5cdFx0dGhpcy51bmlxdWVWYWx1ZU1hcFxuXHRcdFx0LmdldChmaWVsZElkKVxuXHRcdFx0LmlmUHJlc2VudCgodXZjOiBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24pID0+IHtcblx0XHRcdFx0dXZjLnNlbGVjdCh1bmlxdWVWYWx1ZUlkKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0dW5zZWxlY3RBbGwoZmllbGRJZDogRmllbGRJZCk6IHZvaWQge1xuXG5cdFx0dGhpcy51bmlxdWVWYWx1ZU1hcFxuXHRcdFx0LmdldChmaWVsZElkKVxuXHRcdFx0LmlmUHJlc2VudCgodXZjOiBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24pID0+IHtcblx0XHRcdFx0dXZjLnVuc2VsZWN0QWxsKCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHVuc2VsZWN0KGZpZWxkSWQ6IEZpZWxkSWQsIHVuaXF1ZVZhbHVlSWQ6IFVuaXF1ZVZhbHVlSWQpOiB2b2lkIHtcblxuXHRcdHRoaXMudW5pcXVlVmFsdWVNYXBcblx0XHRcdC5nZXQoZmllbGRJZClcblx0XHRcdC5pZlByZXNlbnQoKHV2YzogVW5pcXVlVmFsdWVDb2xsZWN0aW9uKSA9PiB7XG5cdFx0XHRcdHV2Yy51bnNlbGVjdCh1bmlxdWVWYWx1ZUlkKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0Z2V0QWxsKGZpZWxkczogQXJyYXk8RmllbGQ+KTogTWFwPHN0cmluZywgQXJyYXk8VW5pcXVlVmFsdWU+PiB7XG5cblx0XHRjb25zdCBtYXAgPSBuZXcgTWFwKCk7XG5cblx0XHRmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkcykge1xuXG5cdFx0XHR0aGlzLmdldFZhbHVlcyhmaWVsZClcblx0XHRcdFx0LmlmUHJlc2VudCgodikgPT4ge1xuXHRcdFx0XHRcdG1hcC5zZXQoZmllbGQuZ2V0SWQoKS50b1N0cmluZygpLCB2KTtcblx0XHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcDtcblx0fVxuXG5cdGdldFZhbHVlcyhmaWVsZDogRmllbGQpOiBPcHRpb25hbDxBcnJheTxVbmlxdWVWYWx1ZT4+IHtcblxuXHRcdHJldHVybiB0aGlzLnVuaXF1ZVZhbHVlTWFwXG5cdFx0XHRcdCAgIC5nZXQoZmllbGQuZ2V0SWQoKSlcblx0XHRcdFx0ICAgLm1hcCgodXZjOiBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24pID0+IHtcblx0XHRcdFx0XHQgICByZXR1cm4gdXZjLmdldEFsbCgpO1xuXHRcdFx0XHQgICB9KTtcblx0fVxuXG59XG4iXX0=