import { Optional } from '../common/optional';
import { DomainEventBus } from '../core/domain/event/domain-event.bus';
import { CoreContainer } from '../core/api/core.container';
export function assertDomainEvents(actualEvents, expectedEvents) {
    expect(actualEvents.length).toEqual(expectedEvents.length);
    for (const actualEvent of actualEvents) {
        const expectedEvent = expectedEvents.find((event) => {
            return event.equalsByType(actualEvent);
        });
        expect(expectedEvent).toBeDefined();
        expect(actualEvent.equalsByType(expectedEvent)).toBeTruthy();
        // expect(actualEvent.aggregateId).toEqual(expectedEvent.aggregateId, 'Events aggregateId should be the same');
        expect(actualEvent.getPayload()).toEqual(expectedEvent.getPayload(), 'Events payload should be the same');
    }
}
export function assertAggregateEvents(actualEvents, expectedEvents) {
    expect(actualEvents.length).toEqual(expectedEvents.length, 'Aggregate events');
    for (const actualEvent of actualEvents) {
        const expectedEvent = expectedEvents.find((event) => {
            return event.equals(actualEvent);
        });
        expect(expectedEvent).toBeDefined();
    }
}
export function testEventRepositoryIsEmptyOnStart(createStream, desc) {
    it('should be no ' + desc + ' events on start', () => {
        expect.assertions(3);
        // given
        const nextFn = jest.fn(), errorFn = jest.fn(), completeFn = jest.fn();
        // when
        createStream()
            .subscribe(() => nextFn(), (err) => errorFn(err), () => completeFn());
        // then
        expect(nextFn).not.toHaveBeenCalled();
        expect(errorFn).not.toHaveBeenCalled();
        expect(completeFn).not.toHaveBeenCalled();
    });
}
export function onDefaultValuesWarehouseTest(createStream, defaultValue, desc) {
    it('should have default value ' + desc, () => {
        expect.assertions(4);
        // given
        const nextFn = jest.fn(), errorFn = jest.fn(), completeFn = jest.fn();
        // when
        createStream()
            .subscribe((value) => nextFn(value), (err) => errorFn(err), () => completeFn());
        // then
        expect(nextFn).toHaveBeenCalledWith(defaultValue);
        expect(nextFn).toHaveBeenCalledTimes(1);
        expect(errorFn).not.toHaveBeenCalled();
        expect(completeFn).not.toHaveBeenCalled();
    });
}
export function onceDefaultValuesWarehouseTest(createStream, defaultValue, desc) {
    it('should have default value ' + desc, () => {
        expect.assertions(4);
        // given
        const nextFn = jest.fn(), errorFn = jest.fn(), completeFn = jest.fn();
        // when
        createStream()
            .subscribe((value) => nextFn(value), (err) => errorFn(err), () => completeFn());
        // then
        expect(nextFn).toHaveBeenCalledWith(defaultValue);
        expect(nextFn).toHaveBeenCalledTimes(1);
        expect(errorFn).not.toHaveBeenCalled();
        expect(completeFn).toHaveBeenCalledTimes(1);
    });
}
export function onWarehouseEmpty(createStream, desc) {
    it('should be empty ' + desc, () => {
        expect.assertions(3);
        // given
        const nextFn = jest.fn(), errorFn = jest.fn(), completeFn = jest.fn();
        // when
        createStream()
            .subscribe((value) => nextFn(value), (err) => errorFn(err), () => completeFn());
        // then
        expect(nextFn).not.toHaveBeenCalled();
        expect(errorFn).not.toHaveBeenCalled();
        expect(completeFn).not.toHaveBeenCalled();
    });
}
export function findDefaultValuesWarehouseTest(createValue, defaultValue, desc) {
    it('should find default value' + desc, function () {
        expect.assertions(1);
        expect(createValue()).toEqual(Optional.of(defaultValue));
    });
}
export function commandInterceptedByHandlerTest(dispatch, handlerType) {
    it('should trigger command handler', () => {
        expect.assertions(1);
        // given
        const handler = CoreContainer.resolve(handlerType), handlerSpy = jest.spyOn(handler, 'handle');
        // when
        dispatch();
        // then
        expect(handlerSpy).toHaveBeenCalled();
    });
}
export function commandPublishEventTest(dispatch, eventType) {
    it('should dispatch event', () => {
        expect.assertions(1);
        // given
        CoreContainer.resolve(DomainEventBus)
            .subscribe((event) => {
            // then
            if (event instanceof eventType) {
                expect(event instanceof eventType).toEqual(true);
            }
        });
        // when
        dispatch();
    });
}
export function commandTriggersHandlerAndPublishEventTest(dispatch, handlerType, eventType) {
    commandInterceptedByHandlerTest(dispatch, handlerType);
    commandPublishEventTest(dispatch, eventType);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2J1aWxkLWNsaS9wcm9qZWN0cy9ndWktaGVybWVzL3NyYy90ZXN0aW5nL2hlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBS0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUN2RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFNM0QsTUFBTSxVQUFVLGtCQUFrQixDQUF3QixZQUEyQyxFQUFFLGNBQXFDO0lBRTNJLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUUzRCxLQUFLLE1BQU0sV0FBVyxJQUFJLFlBQVksRUFBRTtRQUV2QyxNQUFNLGFBQWEsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBcUIsRUFBRSxFQUFFO1lBQ25FLE9BQU8sS0FBSyxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQyxNQUFNLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzdELCtHQUErRztRQUMvRyxNQUFNLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVBQUUsRUFBRSxtQ0FBbUMsQ0FBQyxDQUFDO0tBQzFHO0FBRUYsQ0FBQztBQUVELE1BQU0sVUFBVSxxQkFBcUIsQ0FBd0IsWUFBOEMsRUFBRSxjQUF3QztJQUVwSixNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FB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Q0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLFVBQVUsdUJBQXVCLENBQUMsUUFBb0IsRUFBRSxTQUFjO0lBRTNFLEVBQUUsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFFaEMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVyQixRQUFRO1FBQ1IsYUFBYSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7YUFDaEMsU0FBUyxDQUFDLENBQUMsS0FBVSxFQUFFLEVBQUU7WUFFekIsT0FBTztZQUNQLElBQUksS0FBSyxZQUFZLFNBQVMsRUFBRTtnQkFDL0IsTUFBTSxDQUFDLEtBQUssWUFBWSxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDakQ7UUFDRixDQUFDLENBQUMsQ0FBQztRQUVQLE9BQU87UUFDUCxRQUFRLEVBQUUsQ0FBQztJQUNaLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSx5Q0FBeUMsQ0FBQyxRQUFvQixFQUFFLFdBQWdCLEVBQUUsU0FBYztJQUUvRywrQkFBK0IsQ0FDOUIsUUFBUSxFQUNSLFdBQVcsQ0FDWCxDQUFDO0lBRUYsdUJBQXVCLENBQ3RCLFFBQVEsRUFDUixTQUFTLENBQ1QsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZ2dyZWdhdGVJZCB9IGZyb20gJy4uL2NvcmUvYXBpL3RhY3RpY2FsL2FnZ3JlZ2F0ZS9hZ2dyZWdhdGUtaWQnO1xuXG5pbXBvcnQgeyBBZ2dyZWdhdGVFdmVudCB9IGZyb20gJy4uL2NvcmUvYXBpL3RhY3RpY2FsL2FnZ3JlZ2F0ZS9hZ2dyZWdhdGUtZXZlbnQnO1xuaW1wb3J0IHsgRG9tYWluRXZlbnQgfSBmcm9tICcuLi9jb3JlL2FwaS9ldmVudC9kb21haW4tZXZlbnQnO1xuaW1wb3J0IHsgSGVybWVzT2JzZXJ2YWJsZSB9IGZyb20gJy4uL2NvbW1vbi9zdHJlYW0vY29yZS9vYnNlcnZhYmxlL2hlcm1lcy5vYnNlcnZhYmxlJztcbmltcG9ydCB7IE9wdGlvbmFsIH0gZnJvbSAnLi4vY29tbW9uL29wdGlvbmFsJztcbmltcG9ydCB7IERvbWFpbkV2ZW50QnVzIH0gZnJvbSAnLi4vY29yZS9kb21haW4vZXZlbnQvZG9tYWluLWV2ZW50LmJ1cyc7XG5pbXBvcnQgeyBDb3JlQ29udGFpbmVyIH0gZnJvbSAnLi4vY29yZS9hcGkvY29yZS5jb250YWluZXInO1xuXG5kZWNsYXJlIGNvbnN0IGV4cGVjdDogYW55O1xuZGVjbGFyZSBjb25zdCBpdDogYW55O1xuZGVjbGFyZSBjb25zdCBqZXN0OiBhbnk7XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnREb21haW5FdmVudHM8SSBleHRlbmRzIEFnZ3JlZ2F0ZUlkPihhY3R1YWxFdmVudHM6IFJlYWRvbmx5QXJyYXk8RG9tYWluRXZlbnQ8ST4+LCBleHBlY3RlZEV2ZW50czogQXJyYXk8RG9tYWluRXZlbnQ8ST4+KTogdm9pZCB7XG5cblx0ZXhwZWN0KGFjdHVhbEV2ZW50cy5sZW5ndGgpLnRvRXF1YWwoZXhwZWN0ZWRFdmVudHMubGVuZ3RoKTtcblxuXHRmb3IgKGNvbnN0IGFjdHVhbEV2ZW50IG9mIGFjdHVhbEV2ZW50cykge1xuXG5cdFx0Y29uc3QgZXhwZWN0ZWRFdmVudCA9IGV4cGVjdGVkRXZlbnRzLmZpbmQoKGV2ZW50OiBEb21haW5FdmVudDxJPikgPT4ge1xuXHRcdFx0cmV0dXJuIGV2ZW50LmVxdWFsc0J5VHlwZShhY3R1YWxFdmVudCk7XG5cdFx0fSk7XG5cblx0XHRleHBlY3QoZXhwZWN0ZWRFdmVudCkudG9CZURlZmluZWQoKTtcblx0XHRleHBlY3QoYWN0dWFsRXZlbnQuZXF1YWxzQnlUeXBlKGV4cGVjdGVkRXZlbnQpKS50b0JlVHJ1dGh5KCk7XG5cdFx0Ly8gZXhwZWN0KGFjdHVhbEV2ZW50LmFnZ3JlZ2F0ZUlkKS50b0VxdWFsKGV4cGVjdGVkRXZlbnQuYWdncmVnYXRlSWQsICdFdmVudHMgYWdncmVnYXRlSWQgc2hvdWxkIGJlIHRoZSBzYW1lJyk7XG5cdFx0ZXhwZWN0KGFjdHVhbEV2ZW50LmdldFBheWxvYWQoKSkudG9FcXVhbChleHBlY3RlZEV2ZW50LmdldFBheWxvYWQoKSwgJ0V2ZW50cyBwYXlsb2FkIHNob3VsZCBiZSB0aGUgc2FtZScpO1xuXHR9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydEFnZ3JlZ2F0ZUV2ZW50czxUIGV4dGVuZHMgQWdncmVnYXRlSWQ+KGFjdHVhbEV2ZW50czogUmVhZG9ubHlBcnJheTxBZ2dyZWdhdGVFdmVudDxUPj4sIGV4cGVjdGVkRXZlbnRzOiBBcnJheTxBZ2dyZWdhdGVFdmVudDxUPj4pOiB2b2lkIHtcblxuXHRleHBlY3QoYWN0dWFsRXZlbnRzLmxlbmd0aCkudG9FcXVhbChleHBlY3RlZEV2ZW50cy5sZW5ndGgsICdBZ2dyZWdhdGUgZXZlbnRzJyk7XG5cblx0Zm9yIChjb25zdCBhY3R1YWxFdmVudCBvZiBhY3R1YWxFdmVudHMpIHtcblxuXHRcdGNvbnN0IGV4cGVjdGVkRXZlbnQgPSBleHBlY3RlZEV2ZW50cy5maW5kKChldmVudDogQWdncmVnYXRlRXZlbnQ8VD4pID0+IHtcblx0XHRcdHJldHVybiBldmVudC5lcXVhbHMoYWN0dWFsRXZlbnQpO1xuXHRcdH0pO1xuXG5cdFx0ZXhwZWN0KGV4cGVjdGVkRXZlbnQpLnRvQmVEZWZpbmVkKCk7XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRlc3RFdmVudFJlcG9zaXRvcnlJc0VtcHR5T25TdGFydDxUPihjcmVhdGVTdHJlYW06ICgpID0+IEhlcm1lc09ic2VydmFibGU8VD4sIGRlc2M6IHN0cmluZyk6IHZvaWQge1xuXG5cdGl0KCdzaG91bGQgYmUgbm8gJyArIGRlc2MgKyAnIGV2ZW50cyBvbiBzdGFydCcsICgpID0+IHtcblxuXHRcdGV4cGVjdC5hc3NlcnRpb25zKDMpO1xuXG5cdFx0Ly8gZ2l2ZW5cblx0XHRjb25zdCBuZXh0Rm4gPSBqZXN0LmZuKCksXG5cdFx0XHRlcnJvckZuID0gamVzdC5mbigpLFxuXHRcdFx0Y29tcGxldGVGbiA9IGplc3QuZm4oKTtcblxuXHRcdC8vIHdoZW5cblx0XHRjcmVhdGVTdHJlYW0oKVxuXHRcdFx0LnN1YnNjcmliZShcblx0XHRcdFx0KCkgPT4gbmV4dEZuKCksXG5cdFx0XHRcdChlcnI6IGFueSkgPT4gZXJyb3JGbihlcnIpLFxuXHRcdFx0XHQoKSA9PiBjb21wbGV0ZUZuKClcblx0XHRcdCk7XG5cblx0XHQvLyB0aGVuXG5cdFx0ZXhwZWN0KG5leHRGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0XHRleHBlY3QoZXJyb3JGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0XHRleHBlY3QoY29tcGxldGVGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbkRlZmF1bHRWYWx1ZXNXYXJlaG91c2VUZXN0PFQ+KGNyZWF0ZVN0cmVhbTogKCkgPT4gSGVybWVzT2JzZXJ2YWJsZTxUPiwgZGVmYXVsdFZhbHVlOiBULCBkZXNjOiBzdHJpbmcpOiB2b2lkIHtcblxuXHRpdCgnc2hvdWxkIGhhdmUgZGVmYXVsdCB2YWx1ZSAnICsgZGVzYywgKCkgPT4ge1xuXG5cdFx0ZXhwZWN0LmFzc2VydGlvbnMoNCk7XG5cblx0XHQvLyBnaXZlblxuXHRcdGNvbnN0IG5leHRGbiA9IGplc3QuZm4oKSxcblx0XHRcdGVycm9yRm4gPSBqZXN0LmZuKCksXG5cdFx0XHRjb21wbGV0ZUZuID0gamVzdC5mbigpO1xuXG5cdFx0Ly8gd2hlblxuXHRcdGNyZWF0ZVN0cmVhbSgpXG5cdFx0XHQuc3Vic2NyaWJlKFxuXHRcdFx0XHQodmFsdWUpID0+IG5leHRGbih2YWx1ZSksXG5cdFx0XHRcdChlcnI6IGFueSkgPT4gZXJyb3JGbihlcnIpLFxuXHRcdFx0XHQoKSA9PiBjb21wbGV0ZUZuKClcblx0XHRcdCk7XG5cblx0XHQvLyB0aGVuXG5cdFx0ZXhwZWN0KG5leHRGbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZGVmYXVsdFZhbHVlKTtcblx0XHRleHBlY3QobmV4dEZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG5cdFx0ZXhwZWN0KGVycm9yRm4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cdFx0ZXhwZWN0KGNvbXBsZXRlRm4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cdH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb25jZURlZmF1bHRWYWx1ZXNXYXJlaG91c2VUZXN0PFQ+KGNyZWF0ZVN0cmVhbTogKCkgPT4gSGVybWVzT2JzZXJ2YWJsZTxUPiwgZGVmYXVsdFZhbHVlOiBULCBkZXNjOiBzdHJpbmcpOiB2b2lkIHtcblxuXHRpdCgnc2hvdWxkIGhhdmUgZGVmYXVsdCB2YWx1ZSAnICsgZGVzYywgKCkgPT4ge1xuXG5cdFx0ZXhwZWN0LmFzc2VydGlvbnMoNCk7XG5cblx0XHQvLyBnaXZlblxuXHRcdGNvbnN0IG5leHRGbiA9IGplc3QuZm4oKSxcblx0XHRcdGVycm9yRm4gPSBqZXN0LmZuKCksXG5cdFx0XHRjb21wbGV0ZUZuID0gamVzdC5mbigpO1xuXG5cdFx0Ly8gd2hlblxuXHRcdGNyZWF0ZVN0cmVhbSgpXG5cdFx0XHQuc3Vic2NyaWJlKFxuXHRcdFx0XHQodmFsdWUpID0+IG5leHRGbih2YWx1ZSksXG5cdFx0XHRcdChlcnI6IGFueSkgPT4gZXJyb3JGbihlcnIpLFxuXHRcdFx0XHQoKSA9PiBjb21wbGV0ZUZuKClcblx0XHRcdCk7XG5cblx0XHQvLyB0aGVuXG5cdFx0ZXhwZWN0KG5leHRGbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZGVmYXVsdFZhbHVlKTtcblx0XHRleHBlY3QobmV4dEZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG5cdFx0ZXhwZWN0KGVycm9yRm4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cdFx0ZXhwZWN0KGNvbXBsZXRlRm4pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbldhcmVob3VzZUVtcHR5PFQ+KGNyZWF0ZVN0cmVhbTogKCkgPT4gSGVybWVzT2JzZXJ2YWJsZTxUPiwgZGVzYzogc3RyaW5nKTogdm9pZCB7XG5cblx0aXQoJ3Nob3VsZCBiZSBlbXB0eSAnICsgZGVzYywgKCkgPT4ge1xuXG5cdFx0ZXhwZWN0LmFzc2VydGlvbnMoMyk7XG5cblx0XHQvLyBnaXZlblxuXHRcdGNvbnN0IG5leHRGbiA9IGplc3QuZm4oKSxcblx0XHRcdGVycm9yRm4gPSBqZXN0LmZuKCksXG5cdFx0XHRjb21wbGV0ZUZuID0gamVzdC5mbigpO1xuXG5cdFx0Ly8gd2hlblxuXHRcdGNyZWF0ZVN0cmVhbSgpXG5cdFx0XHQuc3Vic2NyaWJlKFxuXHRcdFx0XHQodmFsdWUpID0+IG5leHRGbih2YWx1ZSksXG5cdFx0XHRcdChlcnI6IGFueSkgPT4gZXJyb3JGbihlcnIpLFxuXHRcdFx0XHQoKSA9PiBjb21wbGV0ZUZuKClcblx0XHRcdCk7XG5cblx0XHQvLyB0aGVuXG5cdFx0ZXhwZWN0KG5leHRGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0XHRleHBlY3QoZXJyb3JGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0XHRleHBlY3QoY29tcGxldGVGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kRGVmYXVsdFZhbHVlc1dhcmVob3VzZVRlc3Q8VD4oY3JlYXRlVmFsdWU6ICgpID0+IE9wdGlvbmFsPFQ+LCBkZWZhdWx0VmFsdWU6IFQsIGRlc2M6IHN0cmluZykge1xuXG5cdGl0KCdzaG91bGQgZmluZCBkZWZhdWx0IHZhbHVlJyArIGRlc2MsIGZ1bmN0aW9uKCkge1xuXG5cdFx0ZXhwZWN0LmFzc2VydGlvbnMoMSk7XG5cblx0XHRleHBlY3QoY3JlYXRlVmFsdWUoKSkudG9FcXVhbChPcHRpb25hbC5vZihkZWZhdWx0VmFsdWUpKTtcblx0fSk7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbW1hbmRJbnRlcmNlcHRlZEJ5SGFuZGxlclRlc3QoZGlzcGF0Y2g6ICgpID0+IHZvaWQsIGhhbmRsZXJUeXBlOiBhbnkpOiB2b2lkIHtcblxuXHRpdCgnc2hvdWxkIHRyaWdnZXIgY29tbWFuZCBoYW5kbGVyJywgKCkgPT4ge1xuXG5cdFx0ZXhwZWN0LmFzc2VydGlvbnMoMSk7XG5cblx0XHQvLyBnaXZlblxuXHRcdGNvbnN0IGhhbmRsZXIgPSBDb3JlQ29udGFpbmVyLnJlc29sdmUoaGFuZGxlclR5cGUpLFxuXHRcdFx0aGFuZGxlclNweSA9IGplc3Quc3B5T24oaGFuZGxlciwgJ2hhbmRsZScpO1xuXG5cdFx0Ly8gd2hlblxuXHRcdGRpc3BhdGNoKCk7XG5cblx0XHQvLyB0aGVuXG5cdFx0ZXhwZWN0KGhhbmRsZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21tYW5kUHVibGlzaEV2ZW50VGVzdChkaXNwYXRjaDogKCkgPT4gdm9pZCwgZXZlbnRUeXBlOiBhbnkpOiB2b2lkIHtcblxuXHRpdCgnc2hvdWxkIGRpc3BhdGNoIGV2ZW50JywgKCkgPT4ge1xuXG5cdFx0ZXhwZWN0LmFzc2VydGlvbnMoMSk7XG5cblx0XHQvLyBnaXZlblxuXHRcdENvcmVDb250YWluZXIucmVzb2x2ZShEb21haW5FdmVudEJ1cylcblx0XHRcdFx0XHQgLnN1YnNjcmliZSgoZXZlbnQ6IGFueSkgPT4ge1xuXG5cdFx0XHRcdFx0XHQgLy8gdGhlblxuXHRcdFx0XHRcdFx0IGlmIChldmVudCBpbnN0YW5jZW9mIGV2ZW50VHlwZSkge1xuXHRcdFx0XHRcdFx0XHQgZXhwZWN0KGV2ZW50IGluc3RhbmNlb2YgZXZlbnRUeXBlKS50b0VxdWFsKHRydWUpO1xuXHRcdFx0XHRcdFx0IH1cblx0XHRcdFx0XHQgfSk7XG5cblx0XHQvLyB3aGVuXG5cdFx0ZGlzcGF0Y2goKTtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21tYW5kVHJpZ2dlcnNIYW5kbGVyQW5kUHVibGlzaEV2ZW50VGVzdChkaXNwYXRjaDogKCkgPT4gdm9pZCwgaGFuZGxlclR5cGU6IGFueSwgZXZlbnRUeXBlOiBhbnkpOiB2b2lkIHtcblxuXHRjb21tYW5kSW50ZXJjZXB0ZWRCeUhhbmRsZXJUZXN0KFxuXHRcdGRpc3BhdGNoLFxuXHRcdGhhbmRsZXJUeXBlXG5cdCk7XG5cblx0Y29tbWFuZFB1Ymxpc2hFdmVudFRlc3QoXG5cdFx0ZGlzcGF0Y2gsXG5cdFx0ZXZlbnRUeXBlXG5cdCk7XG59XG4iXX0=