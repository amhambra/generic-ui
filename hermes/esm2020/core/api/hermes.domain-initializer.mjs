import { HermesModule } from './hermes.module';
import { CoreContainer } from '../../index';
export class DomainInitializer {
    constructor(api, domain) {
        this.api = api;
        this.domain = domain;
        this.container = CoreContainer;
        this.initialized = false;
    }
    init() {
        if (this.initialized) {
            return;
        }
        this.defineAggregate();
        this.registerApiProviders();
        this.registerDomainProviders();
        this.registerCommandHandlers();
        this.registerEventHandlers();
        this.registerMultiEventHandlers();
        this.initialized = true;
    }
    defineAggregate() {
        const definition = this.domain.defineAggregate();
        if (definition) {
            HermesModule.defineAggregate(definition.aggregateKey, definition.createCommandHandler, definition.factory, definition.repository);
        }
    }
    registerApiProviders() {
        this.api.registerProviders(this.container);
    }
    registerDomainProviders() {
        this.domain.registerProviders(this.container);
    }
    registerCommandHandlers() {
        this.domain
            .registerCommandHandlers()
            .forEach((ch) => {
            HermesModule.registerCommandHandler(ch, this.domain.registerKey(this.container));
        });
    }
    registerEventHandlers() {
        this.domain
            .registerDomainEventHandler()
            .forEach((dh) => {
            HermesModule.registerDomainEventHandler(dh);
        });
    }
    registerMultiEventHandlers() {
        this.domain
            .registerMultiDomainEventHandler()
            .forEach((dh) => {
            HermesModule.registerMultiDomainEventHandler(dh);
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVybWVzLmRvbWFpbi1pbml0aWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2J1aWxkLWNsaS9wcm9qZWN0cy9ndWktaGVybWVzL3NyYy9jb3JlL2FwaS9oZXJtZXMuZG9tYWluLWluaXRpYWxpemVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBR04sYUFBYSxFQUtiLE1BQU0sYUFBYSxDQUFDO0FBb0NyQixNQUFNLE9BQU8saUJBQWlCO0lBTTdCLFlBQTZCLEdBQWlCLEVBQzFCLE1BQXVCO1FBRGQsUUFBRyxHQUFILEdBQUcsQ0FBYztRQUMxQixXQUFNLEdBQU4sTUFBTSxDQUFpQjtRQUwxQixjQUFTLEdBQWMsYUFBYSxDQUFDO1FBRTlDLGdCQUFXLEdBQUcsS0FBSyxDQUFDO0lBSTVCLENBQUM7SUFFRCxJQUFJO1FBRUgsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3JCLE9BQU87U0FDUDtRQUdELElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV2QixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztRQUUvQixJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztRQUVsQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztJQUN6QixDQUFDO0lBRU8sZUFBZTtRQUN0QixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRWpELElBQUksVUFBVSxFQUFFO1lBQ2YsWUFBWSxDQUFDLGVBQWUsQ0FDM0IsVUFBVSxDQUFDLFlBQVksRUFDdkIsVUFBVSxDQUFDLG9CQUFvQixFQUMvQixVQUFVLENBQUMsT0FBTyxFQUNsQixVQUFVLENBQUMsVUFBVSxDQUNyQixDQUFDO1NBQ0Y7SUFDRixDQUFDO0lBRU8sb0JBQW9CO1FBQzNCLElBQUksQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFTyx1QkFBdUI7UUFDOUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVPLHVCQUF1QjtRQUM5QixJQUFJLENBQUMsTUFBTTthQUNULHVCQUF1QixFQUFFO2FBQ3pCLE9BQU8sQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFO1lBQ2YsWUFBWSxDQUFDLHNCQUFzQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxxQkFBcUI7UUFDNUIsSUFBSSxDQUFDLE1BQU07YUFDVCwwQkFBMEIsRUFBRTthQUM1QixPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtZQUNmLFlBQVksQ0FBQywwQkFBMEIsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTywwQkFBMEI7UUFDakMsSUFBSSxDQUFDLE1BQU07YUFDVCwrQkFBK0IsRUFBRTthQUNqQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtZQUNmLFlBQVksQ0FBQywrQkFBK0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FFRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFnZ3JlZ2F0ZUlkIH0gZnJvbSAnLi90YWN0aWNhbC9hZ2dyZWdhdGUvYWdncmVnYXRlLWlkJztcbmltcG9ydCB7IEFnZ3JlZ2F0ZVJvb3QgfSBmcm9tICcuL3RhY3RpY2FsL2FnZ3JlZ2F0ZS9hZ2dyZWdhdGUtcm9vdCc7XG5pbXBvcnQgeyBDb21tYW5kIH0gZnJvbSAnLi9jb21tYW5kL2NvbW1hbmQnO1xuaW1wb3J0IHsgQ29tbWFuZEhhbmRsZXIgfSBmcm9tICcuLi9kb21haW4vY29tbWFuZC9oYW5kbGVyL2NvbW1hbmQuaGFuZGxlcic7XG5pbXBvcnQgeyBIZXJtZXNNb2R1bGUgfSBmcm9tICcuL2hlcm1lcy5tb2R1bGUnO1xuaW1wb3J0IHtcblx0QWdncmVnYXRlRmFjdG9yeSwgQWdncmVnYXRlUmVwb3NpdG9yeSxcblx0Q29udGFpbmVyLFxuXHRDb3JlQ29udGFpbmVyLFxuXHRDcmVhdGVBZ2dyZWdhdGVDb21tYW5kSGFuZGxlcixcblx0RG9tYWluRXZlbnQsXG5cdERvbWFpbkV2ZW50SGFuZGxlcixcblx0TXVsdGlEb21haW5FdmVudEhhbmRsZXJcbn0gZnJvbSAnLi4vLi4vaW5kZXgnO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgVHlwZTxUPiBleHRlbmRzIEZ1bmN0aW9uIHtcblx0bmV3KC4uLmFyZ3M6IGFueVtdKTogVDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcGlQcm92aWRlcnMge1xuXG5cdHJlZ2lzdGVyUHJvdmlkZXJzKGNvbnRhaW5lcjogQ29udGFpbmVyKTogdm9pZDtcblxufVxuXG5leHBvcnQgdHlwZSBBZ2dyZWdhdGVEZWZpbml0aW9uPEkgZXh0ZW5kcyBBZ2dyZWdhdGVJZCwgQSBleHRlbmRzIEFnZ3JlZ2F0ZVJvb3Q8ST4sIEMgZXh0ZW5kcyBDb21tYW5kPEk+PiA9IHtcblx0YWdncmVnYXRlS2V5OiBzdHJpbmcsXG5cdGNyZWF0ZUNvbW1hbmRIYW5kbGVyOiBUeXBlPENyZWF0ZUFnZ3JlZ2F0ZUNvbW1hbmRIYW5kbGVyPEM+Pixcblx0ZmFjdG9yeTogVHlwZTxBZ2dyZWdhdGVGYWN0b3J5PEksIEE+Pixcblx0cmVwb3NpdG9yeTogVHlwZTxBZ2dyZWdhdGVSZXBvc2l0b3J5PEksIEE+PlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIERvbWFpblByb3ZpZGVycyB7XG5cblx0ZGVmaW5lQWdncmVnYXRlPEkgZXh0ZW5kcyBBZ2dyZWdhdGVJZCwgQSBleHRlbmRzIEFnZ3JlZ2F0ZVJvb3Q8ST4sIEMgZXh0ZW5kcyBDb21tYW5kPEk+PigpOiBBZ2dyZWdhdGVEZWZpbml0aW9uPEksIEEsIEM+IHwgbnVsbDtcblxuXHRyZWdpc3RlcktleShjb250YWluZXI6IENvbnRhaW5lcik6IHN0cmluZztcblxuXHRyZWdpc3RlclByb3ZpZGVycyhjb250YWluZXI6IENvbnRhaW5lcik6IHZvaWQ7XG5cblx0cmVnaXN0ZXJDb21tYW5kSGFuZGxlcnM8SSBleHRlbmRzIEFnZ3JlZ2F0ZUlkLCBBIGV4dGVuZHMgQWdncmVnYXRlUm9vdDxJPiwgQyBleHRlbmRzIENvbW1hbmQ8ST4+KCk6IEFycmF5PFR5cGU8Q29tbWFuZEhhbmRsZXI8QSwgQz4+PjtcblxuXHRyZWdpc3RlckRvbWFpbkV2ZW50SGFuZGxlcjxJIGV4dGVuZHMgQWdncmVnYXRlSWQsIEUgZXh0ZW5kcyBEb21haW5FdmVudDxJPj4oKTogQXJyYXk8VHlwZTxEb21haW5FdmVudEhhbmRsZXI8SSwgRT4+PjtcblxuXHRyZWdpc3Rlck11bHRpRG9tYWluRXZlbnRIYW5kbGVyPEkgZXh0ZW5kcyBBZ2dyZWdhdGVJZCwgRSBleHRlbmRzIERvbWFpbkV2ZW50PEk+PigpOiBBcnJheTxUeXBlPE11bHRpRG9tYWluRXZlbnRIYW5kbGVyPEksIEU+Pj47XG5cbn1cblxuZXhwb3J0IGNsYXNzIERvbWFpbkluaXRpYWxpemVyIHtcblxuXHRwcml2YXRlIHJlYWRvbmx5IGNvbnRhaW5lcjogQ29udGFpbmVyID0gQ29yZUNvbnRhaW5lcjtcblxuXHRwcml2YXRlIGluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBhcGk6IEFwaVByb3ZpZGVycyxcblx0XHRcdFx0cHJpdmF0ZSByZWFkb25seSBkb21haW46IERvbWFpblByb3ZpZGVycykge1xuXHR9XG5cblx0aW5pdCgpOiB2b2lkIHtcblxuXHRcdGlmICh0aGlzLmluaXRpYWxpemVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cblx0XHR0aGlzLmRlZmluZUFnZ3JlZ2F0ZSgpO1xuXG5cdFx0dGhpcy5yZWdpc3RlckFwaVByb3ZpZGVycygpO1xuXHRcdHRoaXMucmVnaXN0ZXJEb21haW5Qcm92aWRlcnMoKTtcblxuXHRcdHRoaXMucmVnaXN0ZXJDb21tYW5kSGFuZGxlcnMoKTtcblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnRIYW5kbGVycygpO1xuXHRcdHRoaXMucmVnaXN0ZXJNdWx0aUV2ZW50SGFuZGxlcnMoKTtcblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHR9XG5cblx0cHJpdmF0ZSBkZWZpbmVBZ2dyZWdhdGUoKTogdm9pZCB7XG5cdFx0Y29uc3QgZGVmaW5pdGlvbiA9IHRoaXMuZG9tYWluLmRlZmluZUFnZ3JlZ2F0ZSgpO1xuXG5cdFx0aWYgKGRlZmluaXRpb24pIHtcblx0XHRcdEhlcm1lc01vZHVsZS5kZWZpbmVBZ2dyZWdhdGUoXG5cdFx0XHRcdGRlZmluaXRpb24uYWdncmVnYXRlS2V5LFxuXHRcdFx0XHRkZWZpbml0aW9uLmNyZWF0ZUNvbW1hbmRIYW5kbGVyLFxuXHRcdFx0XHRkZWZpbml0aW9uLmZhY3RvcnksXG5cdFx0XHRcdGRlZmluaXRpb24ucmVwb3NpdG9yeVxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHJlZ2lzdGVyQXBpUHJvdmlkZXJzKCkge1xuXHRcdHRoaXMuYXBpLnJlZ2lzdGVyUHJvdmlkZXJzKHRoaXMuY29udGFpbmVyKTtcblx0fVxuXG5cdHByaXZhdGUgcmVnaXN0ZXJEb21haW5Qcm92aWRlcnMoKSB7XG5cdFx0dGhpcy5kb21haW4ucmVnaXN0ZXJQcm92aWRlcnModGhpcy5jb250YWluZXIpO1xuXHR9XG5cblx0cHJpdmF0ZSByZWdpc3RlckNvbW1hbmRIYW5kbGVycygpIHtcblx0XHR0aGlzLmRvbWFpblxuXHRcdFx0LnJlZ2lzdGVyQ29tbWFuZEhhbmRsZXJzKClcblx0XHRcdC5mb3JFYWNoKChjaCkgPT4ge1xuXHRcdFx0XHRIZXJtZXNNb2R1bGUucmVnaXN0ZXJDb21tYW5kSGFuZGxlcihjaCwgdGhpcy5kb21haW4ucmVnaXN0ZXJLZXkodGhpcy5jb250YWluZXIpKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSByZWdpc3RlckV2ZW50SGFuZGxlcnMoKSB7XG5cdFx0dGhpcy5kb21haW5cblx0XHRcdC5yZWdpc3RlckRvbWFpbkV2ZW50SGFuZGxlcigpXG5cdFx0XHQuZm9yRWFjaCgoZGgpID0+IHtcblx0XHRcdFx0SGVybWVzTW9kdWxlLnJlZ2lzdGVyRG9tYWluRXZlbnRIYW5kbGVyKGRoKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSByZWdpc3Rlck11bHRpRXZlbnRIYW5kbGVycygpIHtcblx0XHR0aGlzLmRvbWFpblxuXHRcdFx0LnJlZ2lzdGVyTXVsdGlEb21haW5FdmVudEhhbmRsZXIoKVxuXHRcdFx0LmZvckVhY2goKGRoKSA9PiB7XG5cdFx0XHRcdEhlcm1lc01vZHVsZS5yZWdpc3Rlck11bHRpRG9tYWluRXZlbnRIYW5kbGVyKGRoKTtcblx0XHRcdH0pO1xuXHR9XG5cbn1cbiJdfQ==