import { CoreContainer } from '../../index';
import { aggregateDefinitionToken } from '../domain/command/config/aggregate-definition.token';
import { CREATE_AGGREGATE_COMMAND_HANDLERS } from '../domain/command/create-aggregate/create-aggregate.command-handlers-token';
import { createAggregateCommandHandlerFactory } from '../domain/command/create-aggregate/create-aggregate.command-handler-impl';
import { COMMAND_HANDLERS } from '../domain/command/handler/command-handlers';
import { commandHandlerFactory } from '../domain/command/handler/command-handler-impl';
import { DOMAIN_EVENT_HANDLERS } from './event/domain-event-handlers';
import { domainEventHandlerFactory, multiDomainEventHandlerFactory } from '../domain/event/handler/domain-event-handler-impl';
export class DomainInitializer {
    constructor(api, domain) {
        this.api = api;
        this.domain = domain;
        this.container = CoreContainer;
        this.initialized = false;
    }
    init() {
        if (this.initialized) {
            return;
        }
        this.defineAggregate();
        this.registerApiProviders();
        this.registerDomainProviders();
        this.registerCommandHandlers();
        this.registerEventHandlers();
        this.registerMultiEventHandlers();
        this.initialized = true;
    }
    defineAggregate() {
        const definition = this.domain.defineAggregate();
        if (definition) {
            this.container.provide(definition.factory);
            this.container.provide(definition.repository);
            this.container.provideValue(definition.aggregateKey, definition.aggregateKey);
            this.container.provideValueCollection(aggregateDefinitionToken, {
                key: definition.aggregateKey,
                factory: definition.factory,
                repository: definition.repository
            });
            this.container.provide(definition.createCommandHandler);
            this.container.provideFactoryCollection(CREATE_AGGREGATE_COMMAND_HANDLERS, {
                create: createAggregateCommandHandlerFactory,
                deps: [
                    definition.createCommandHandler,
                    definition.aggregateKey
                ]
            });
        }
    }
    registerApiProviders() {
        this.api.registerProviders(this.container);
    }
    registerDomainProviders() {
        this.domain.registerProviders(this.container);
    }
    registerCommandHandlers() {
        this.domain
            .registerCommandHandlers()
            .forEach((ch) => {
            this.container.provide(ch);
            this.container.provideFactoryCollection(COMMAND_HANDLERS, {
                create: commandHandlerFactory,
                deps: [
                    ch,
                    this.domain.registerKey(this.container)
                ]
            });
        });
    }
    registerEventHandlers() {
        this.domain
            .registerDomainEventHandler()
            .forEach((eh) => {
            this.container.provide(eh);
            this.container.provideFactoryCollection(DOMAIN_EVENT_HANDLERS, {
                create: domainEventHandlerFactory,
                deps: [
                    eh
                ]
            });
        });
    }
    registerMultiEventHandlers() {
        this.domain
            .registerMultiDomainEventHandler()
            .forEach((eh) => {
            this.container.provide(eh);
            this.container.provideFactoryCollection(DOMAIN_EVENT_HANDLERS, {
                create: multiDomainEventHandlerFactory,
                deps: [
                    eh
                ]
            });
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVybWVzLmRvbWFpbi1pbml0aWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2J1aWxkLWNsaS9wcm9qZWN0cy9ndWktaGVybWVzL3NyYy9jb3JlL2FwaS9oZXJtZXMuZG9tYWluLWluaXRpYWxpemVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE9BQU8sRUFHTixhQUFhLEVBS2IsTUFBTSxhQUFhLENBQUM7QUFDckIsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0scURBQXFELENBQUM7QUFDL0YsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sNEVBQTRFLENBQUM7QUFDL0gsT0FBTyxFQUFFLG9DQUFvQyxFQUFFLE1BQU0sMEVBQTBFLENBQUM7QUFDaEksT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDOUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDdkYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDdEUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLDhCQUE4QixFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFvQzlILE1BQU0sT0FBTyxpQkFBaUI7SUFNN0IsWUFBNkIsR0FBaUIsRUFDMUIsTUFBdUI7UUFEZCxRQUFHLEdBQUgsR0FBRyxDQUFjO1FBQzFCLFdBQU0sR0FBTixNQUFNLENBQWlCO1FBTDFCLGNBQVMsR0FBYyxhQUFhLENBQUM7UUFFOUMsZ0JBQVcsR0FBRyxLQUFLLENBQUM7SUFJNUIsQ0FBQztJQUVELElBQUk7UUFFSCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDckIsT0FBTztTQUNQO1FBR0QsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRXZCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO1FBRS9CLElBQUksQ0FBQyx1QkFBdUIs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QixFQUNyQjtnQkFDQyxNQUFNLEVBQUUsOEJBQThCO2dCQUN0QyxJQUFJLEVBQUU7b0JBQ0wsRUFBRTtpQkFDRjthQUNELENBQ0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWdncmVnYXRlSWQgfSBmcm9tICcuL3RhY3RpY2FsL2FnZ3JlZ2F0ZS9hZ2dyZWdhdGUtaWQnO1xuaW1wb3J0IHsgQWdncmVnYXRlUm9vdCB9IGZyb20gJy4vdGFjdGljYWwvYWdncmVnYXRlL2FnZ3JlZ2F0ZS1yb290JztcbmltcG9ydCB7IENvbW1hbmQgfSBmcm9tICcuL2NvbW1hbmQvY29tbWFuZCc7XG5pbXBvcnQgeyBDb21tYW5kSGFuZGxlciB9IGZyb20gJy4uL2RvbWFpbi9jb21tYW5kL2hhbmRsZXIvY29tbWFuZC5oYW5kbGVyJztcblxuaW1wb3J0IHtcblx0QWdncmVnYXRlRmFjdG9yeSwgQWdncmVnYXRlUmVwb3NpdG9yeSxcblx0Q29udGFpbmVyLFxuXHRDb3JlQ29udGFpbmVyLFxuXHRDcmVhdGVBZ2dyZWdhdGVDb21tYW5kSGFuZGxlcixcblx0RG9tYWluRXZlbnQsXG5cdERvbWFpbkV2ZW50SGFuZGxlcixcblx0TXVsdGlEb21haW5FdmVudEhhbmRsZXJcbn0gZnJvbSAnLi4vLi4vaW5kZXgnO1xuaW1wb3J0IHsgYWdncmVnYXRlRGVmaW5pdGlvblRva2VuIH0gZnJvbSAnLi4vZG9tYWluL2NvbW1hbmQvY29uZmlnL2FnZ3JlZ2F0ZS1kZWZpbml0aW9uLnRva2VuJztcbmltcG9ydCB7IENSRUFURV9BR0dSRUdBVEVfQ09NTUFORF9IQU5ETEVSUyB9IGZyb20gJy4uL2RvbWFpbi9jb21tYW5kL2NyZWF0ZS1hZ2dyZWdhdGUvY3JlYXRlLWFnZ3JlZ2F0ZS5jb21tYW5kLWhhbmRsZXJzLXRva2VuJztcbmltcG9ydCB7IGNyZWF0ZUFnZ3JlZ2F0ZUNvbW1hbmRIYW5kbGVyRmFjdG9yeSB9IGZyb20gJy4uL2RvbWFpbi9jb21tYW5kL2NyZWF0ZS1hZ2dyZWdhdGUvY3JlYXRlLWFnZ3JlZ2F0ZS5jb21tYW5kLWhhbmRsZXItaW1wbCc7XG5pbXBvcnQgeyBDT01NQU5EX0hBTkRMRVJTIH0gZnJvbSAnLi4vZG9tYWluL2NvbW1hbmQvaGFuZGxlci9jb21tYW5kLWhhbmRsZXJzJztcbmltcG9ydCB7IGNvbW1hbmRIYW5kbGVyRmFjdG9yeSB9IGZyb20gJy4uL2RvbWFpbi9jb21tYW5kL2hhbmRsZXIvY29tbWFuZC1oYW5kbGVyLWltcGwnO1xuaW1wb3J0IHsgRE9NQUlOX0VWRU5UX0hBTkRMRVJTIH0gZnJvbSAnLi9ldmVudC9kb21haW4tZXZlbnQtaGFuZGxlcnMnO1xuaW1wb3J0IHsgZG9tYWluRXZlbnRIYW5kbGVyRmFjdG9yeSwgbXVsdGlEb21haW5FdmVudEhhbmRsZXJGYWN0b3J5IH0gZnJvbSAnLi4vZG9tYWluL2V2ZW50L2hhbmRsZXIvZG9tYWluLWV2ZW50LWhhbmRsZXItaW1wbCc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBUeXBlPFQ+IGV4dGVuZHMgRnVuY3Rpb24ge1xuXHRuZXcoLi4uYXJnczogYW55W10pOiBUO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwaVByb3ZpZGVycyB7XG5cblx0cmVnaXN0ZXJQcm92aWRlcnMoY29udGFpbmVyOiBDb250YWluZXIpOiB2b2lkO1xuXG59XG5cbmV4cG9ydCB0eXBlIEFnZ3JlZ2F0ZURlZmluaXRpb248SSBleHRlbmRzIEFnZ3JlZ2F0ZUlkLCBBIGV4dGVuZHMgQWdncmVnYXRlUm9vdDxJPiwgQyBleHRlbmRzIENvbW1hbmQ8ST4+ID0ge1xuXHRhZ2dyZWdhdGVLZXk6IHN0cmluZyxcblx0Y3JlYXRlQ29tbWFuZEhhbmRsZXI6IFR5cGU8Q3JlYXRlQWdncmVnYXRlQ29tbWFuZEhhbmRsZXI8Qz4+LFxuXHRmYWN0b3J5OiBUeXBlPEFnZ3JlZ2F0ZUZhY3Rvcnk8SSwgQT4+LFxuXHRyZXBvc2l0b3J5OiBUeXBlPEFnZ3JlZ2F0ZVJlcG9zaXRvcnk8SSwgQT4+XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIERvbWFpblByb3ZpZGVycyB7XG5cblx0ZGVmaW5lQWdncmVnYXRlPEkgZXh0ZW5kcyBBZ2dyZWdhdGVJZCwgQSBleHRlbmRzIEFnZ3JlZ2F0ZVJvb3Q8ST4sIEMgZXh0ZW5kcyBDb21tYW5kPEk+PigpOiBBZ2dyZWdhdGVEZWZpbml0aW9uPEksIEEsIEM+IHwgbnVsbDtcblxuXHRyZWdpc3RlcktleShjb250YWluZXI6IENvbnRhaW5lcik6IHN0cmluZztcblxuXHRyZWdpc3RlclByb3ZpZGVycyhjb250YWluZXI6IENvbnRhaW5lcik6IHZvaWQ7XG5cblx0cmVnaXN0ZXJDb21tYW5kSGFuZGxlcnM8SSBleHRlbmRzIEFnZ3JlZ2F0ZUlkLCBBIGV4dGVuZHMgQWdncmVnYXRlUm9vdDxJPiwgQyBleHRlbmRzIENvbW1hbmQ8ST4+KCk6IEFycmF5PFR5cGU8Q29tbWFuZEhhbmRsZXI8QSwgQz4+PjtcblxuXHRyZWdpc3RlckRvbWFpbkV2ZW50SGFuZGxlcjxJIGV4dGVuZHMgQWdncmVnYXRlSWQsIEUgZXh0ZW5kcyBEb21haW5FdmVudDxJPj4oKTogQXJyYXk8VHlwZTxEb21haW5FdmVudEhhbmRsZXI8SSwgRT4+PjtcblxuXHRyZWdpc3Rlck11bHRpRG9tYWluRXZlbnRIYW5kbGVyPEkgZXh0ZW5kcyBBZ2dyZWdhdGVJZCwgRSBleHRlbmRzIERvbWFpbkV2ZW50PEk+PigpOiBBcnJheTxUeXBlPE11bHRpRG9tYWluRXZlbnRIYW5kbGVyPEksIEU+Pj47XG5cbn1cblxuZXhwb3J0IGNsYXNzIERvbWFpbkluaXRpYWxpemVyIHtcblxuXHRwcml2YXRlIHJlYWRvbmx5IGNvbnRhaW5lcjogQ29udGFpbmVyID0gQ29yZUNvbnRhaW5lcjtcblxuXHRwcml2YXRlIGluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBhcGk6IEFwaVByb3ZpZGVycyxcblx0XHRcdFx0cHJpdmF0ZSByZWFkb25seSBkb21haW46IERvbWFpblByb3ZpZGVycykge1xuXHR9XG5cblx0aW5pdCgpOiB2b2lkIHtcblxuXHRcdGlmICh0aGlzLmluaXRpYWxpemVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cblx0XHR0aGlzLmRlZmluZUFnZ3JlZ2F0ZSgpO1xuXG5cdFx0dGhpcy5yZWdpc3RlckFwaVByb3ZpZGVycygpO1xuXHRcdHRoaXMucmVnaXN0ZXJEb21haW5Qcm92aWRlcnMoKTtcblxuXHRcdHRoaXMucmVnaXN0ZXJDb21tYW5kSGFuZGxlcnMoKTtcblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnRIYW5kbGVycygpO1xuXHRcdHRoaXMucmVnaXN0ZXJNdWx0aUV2ZW50SGFuZGxlcnMoKTtcblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHR9XG5cblx0cHJpdmF0ZSBkZWZpbmVBZ2dyZWdhdGUoKTogdm9pZCB7XG5cdFx0Y29uc3QgZGVmaW5pdGlvbiA9IHRoaXMuZG9tYWluLmRlZmluZUFnZ3JlZ2F0ZSgpO1xuXG5cdFx0aWYgKGRlZmluaXRpb24pIHtcblx0XHRcdHRoaXMuY29udGFpbmVyLnByb3ZpZGUoZGVmaW5pdGlvbi5mYWN0b3J5KTtcblx0XHRcdHRoaXMuY29udGFpbmVyLnByb3ZpZGUoZGVmaW5pdGlvbi5yZXBvc2l0b3J5KTtcblx0XHRcdHRoaXMuY29udGFpbmVyLnByb3ZpZGVWYWx1ZShkZWZpbml0aW9uLmFnZ3JlZ2F0ZUtleSwgZGVmaW5pdGlvbi5hZ2dyZWdhdGVLZXkpO1xuXHRcdFx0dGhpcy5jb250YWluZXIucHJvdmlkZVZhbHVlQ29sbGVjdGlvbihcblx0XHRcdFx0YWdncmVnYXRlRGVmaW5pdGlvblRva2VuLFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0a2V5OiBkZWZpbml0aW9uLmFnZ3JlZ2F0ZUtleSxcblx0XHRcdFx0XHRmYWN0b3J5OiBkZWZpbml0aW9uLmZhY3RvcnksXG5cdFx0XHRcdFx0cmVwb3NpdG9yeTogZGVmaW5pdGlvbi5yZXBvc2l0b3J5XG5cdFx0XHRcdH1cblx0XHRcdCk7XG5cblx0XHRcdHRoaXMuY29udGFpbmVyLnByb3ZpZGUoZGVmaW5pdGlvbi5jcmVhdGVDb21tYW5kSGFuZGxlcik7XG5cdFx0XHR0aGlzLmNvbnRhaW5lci5wcm92aWRlRmFjdG9yeUNvbGxlY3Rpb24oXG5cdFx0XHRcdENSRUFURV9BR0dSRUdBVEVfQ09NTUFORF9IQU5ETEVSUyxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGNyZWF0ZTogY3JlYXRlQWdncmVnYXRlQ29tbWFuZEhhbmRsZXJGYWN0b3J5LFxuXHRcdFx0XHRcdGRlcHM6IFtcblx0XHRcdFx0XHRcdGRlZmluaXRpb24uY3JlYXRlQ29tbWFuZEhhbmRsZXIsXG5cdFx0XHRcdFx0XHRkZWZpbml0aW9uLmFnZ3JlZ2F0ZUtleVxuXHRcdFx0XHRcdF1cblx0XHRcdFx0fVxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHJlZ2lzdGVyQXBpUHJvdmlkZXJzKCkge1xuXHRcdHRoaXMuYXBpLnJlZ2lzdGVyUHJvdmlkZXJzKHRoaXMuY29udGFpbmVyKTtcblx0fVxuXG5cdHByaXZhdGUgcmVnaXN0ZXJEb21haW5Qcm92aWRlcnMoKSB7XG5cdFx0dGhpcy5kb21haW4ucmVnaXN0ZXJQcm92aWRlcnModGhpcy5jb250YWluZXIpO1xuXHR9XG5cblx0cHJpdmF0ZSByZWdpc3RlckNvbW1hbmRIYW5kbGVycygpIHtcblx0XHR0aGlzLmRvbWFpblxuXHRcdFx0LnJlZ2lzdGVyQ29tbWFuZEhhbmRsZXJzKClcblx0XHRcdC5mb3JFYWNoKChjaCkgPT4ge1xuXHRcdFx0XHR0aGlzLmNvbnRhaW5lci5wcm92aWRlKGNoKTtcblx0XHRcdFx0dGhpcy5jb250YWluZXIucHJvdmlkZUZhY3RvcnlDb2xsZWN0aW9uKFxuXHRcdFx0XHRcdENPTU1BTkRfSEFORExFUlMsXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0Y3JlYXRlOiBjb21tYW5kSGFuZGxlckZhY3RvcnksXG5cdFx0XHRcdFx0XHRkZXBzOiBbXG5cdFx0XHRcdFx0XHRcdGNoLFxuXHRcdFx0XHRcdFx0XHR0aGlzLmRvbWFpbi5yZWdpc3RlcktleSh0aGlzLmNvbnRhaW5lcilcblx0XHRcdFx0XHRcdF1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgcmVnaXN0ZXJFdmVudEhhbmRsZXJzKCkge1xuXHRcdHRoaXMuZG9tYWluXG5cdFx0XHQucmVnaXN0ZXJEb21haW5FdmVudEhhbmRsZXIoKVxuXHRcdFx0LmZvckVhY2goKGVoKSA9PiB7XG5cdFx0XHRcdHRoaXMuY29udGFpbmVyLnByb3ZpZGUoZWgpO1xuXHRcdFx0XHR0aGlzLmNvbnRhaW5lci5wcm92aWRlRmFjdG9yeUNvbGxlY3Rpb24oXG5cdFx0XHRcdFx0RE9NQUlOX0VWRU5UX0hBTkRMRVJTLFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGNyZWF0ZTogZG9tYWluRXZlbnRIYW5kbGVyRmFjdG9yeSxcblx0XHRcdFx0XHRcdGRlcHM6IFtcblx0XHRcdFx0XHRcdFx0ZWhcblx0XHRcdFx0XHRcdF1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgcmVnaXN0ZXJNdWx0aUV2ZW50SGFuZGxlcnMoKSB7XG5cdFx0dGhpcy5kb21haW5cblx0XHRcdC5yZWdpc3Rlck11bHRpRG9tYWluRXZlbnRIYW5kbGVyKClcblx0XHRcdC5mb3JFYWNoKChlaCkgPT4ge1xuXHRcdFx0XHR0aGlzLmNvbnRhaW5lci5wcm92aWRlKGVoKTtcblx0XHRcdFx0dGhpcy5jb250YWluZXIucHJvdmlkZUZhY3RvcnlDb2xsZWN0aW9uKFxuXHRcdFx0XHRcdERPTUFJTl9FVkVOVF9IQU5ETEVSUyxcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRjcmVhdGU6IG11bHRpRG9tYWluRXZlbnRIYW5kbGVyRmFjdG9yeSxcblx0XHRcdFx0XHRcdGRlcHM6IFtcblx0XHRcdFx0XHRcdFx0ZWhcblx0XHRcdFx0XHRcdF1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblx0fVxuXG59XG4iXX0=