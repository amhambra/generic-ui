import { AggregateFactoryArchive, AggregateRepositoryArchive } from './define';
import { CoreContainer } from '../../../api/core.container';
export class AggregateDefinitionInitializer {
    constructor() {
        this.aggregateFactoryArchive = CoreContainer.resolve(AggregateFactoryArchive);
        this.aggregateRepositoryArchive = CoreContainer.resolve(AggregateRepositoryArchive);
    }
    register(definedAggregate) {
        if (definedAggregate) {
            const set = new Set();
            const filteredDefinitions = [];
            definedAggregate.filter((def) => {
                if (!set.has(def.key)) {
                    set.add(def.key);
                    filteredDefinitions.push(def);
                }
            });
            filteredDefinitions.forEach((def) => {
                const factory = CoreContainer.resolve(def.factory), repository = CoreContainer.resolve(def.repository);
                if (!this.aggregateFactoryArchive.has(def.key)) {
                    this.aggregateFactoryArchive.add(def.key, factory);
                }
                if (!this.aggregateRepositoryArchive.has(def.key)) {
                    this.aggregateRepositoryArchive.add(def.key, repository);
                }
            });
            // console.log('Registered aggregate definition:' + filteredDefinitions.length);
            // console.log('Registered aggregate definition:', filteredDefinitions);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdncmVnYXRlLWRlZmluaXRpb24uaW5pdGlhbGl6ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9idWlsZC1jbGkvcHJvamVjdHMvZ3VpLWhlcm1lcy9zcmMvY29yZS9kb21haW4vY29tbWFuZC9jb25maWcvYWdncmVnYXRlLWRlZmluaXRpb24uaW5pdGlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLHVCQUF1QixFQUFFLDBCQUEwQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRy9FLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUk1RCxNQUFNLE9BQU8sOEJBQThCO0lBTTFDO1FBSmlCLDRCQUF1QixHQUFrQyxhQUFhLENBQUMsT0FBTyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFFeEcsK0JBQTBCLEdBQXFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztJQUdsSSxDQUFDO0lBRUQsUUFBUSxDQUNQLGdCQUFrRDtRQUdsRCxJQUFJLGdCQUFnQixFQUFFO1lBRXJCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7WUFDdEIsTUFBTSxtQkFBbUIsR0FBcUMsRUFBRSxDQUFDO1lBRWpFLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQThCLEVBQUUsRUFBRTtnQkFDMUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUN0QixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDakIsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUM5QjtZQUNGLENBQUMsQ0FBQyxDQUFDO1lBRUgsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBOEIsRUFBRSxFQUFFO2dCQUU5RCxNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsT0FBTyxDQUF5QixHQUFHLENBQUMsT0FBYyxDQUFDLEVBQ2hGLFVBQVUsR0FBRyxhQUFhLENBQUMsT0FBTyxDQUE2QixHQUFHLENBQUMsVUFBa0IsQ0FBQyxDQUFDO2dCQUV4RixJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7b0JBQy9DLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztpQkFDbkQ7Z0JBRUQsSUFBSSxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUNsRCxJQUFJLENBQUMsMEJBQTBCLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDLENBQUM7aUJBQ3pEO1lBQ0YsQ0FBQyxDQUFDLENBQUM7WUFFSCxnRkFBZ0Y7WUFDaEYsd0VBQXdFO1NBQ3hFO0lBQ0YsQ0FBQztDQUVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWdncmVnYXRlRGVmaW5pdGlvbiB9IGZyb20gJy4vYWdncmVnYXRlLWRlZmluaXRpb24nO1xuaW1wb3J0IHsgQWdncmVnYXRlRmFjdG9yeUFyY2hpdmUsIEFnZ3JlZ2F0ZVJlcG9zaXRvcnlBcmNoaXZlIH0gZnJvbSAnLi9kZWZpbmUnO1xuaW1wb3J0IHsgQWdncmVnYXRlSWQgfSBmcm9tICcuLi8uLi8uLi9hcGkvdGFjdGljYWwvYWdncmVnYXRlL2FnZ3JlZ2F0ZS1pZCc7XG5pbXBvcnQgeyBBZ2dyZWdhdGVSb290IH0gZnJvbSAnLi4vLi4vLi4vYXBpL3RhY3RpY2FsL2FnZ3JlZ2F0ZS9hZ2dyZWdhdGUtcm9vdCc7XG5pbXBvcnQgeyBDb3JlQ29udGFpbmVyIH0gZnJvbSAnLi4vLi4vLi4vYXBpL2NvcmUuY29udGFpbmVyJztcbmltcG9ydCB7IEFnZ3JlZ2F0ZUZhY3RvcnkgfSBmcm9tICcuLi8uLi8uLi9hcGkvdGFjdGljYWwvYWdncmVnYXRlL2FnZ3JlZ2F0ZS1mYWN0b3J5JztcbmltcG9ydCB7IEFnZ3JlZ2F0ZVJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9hcGkvdGFjdGljYWwvYWdncmVnYXRlL2FnZ3JlZ2F0ZS1yZXBvc2l0b3J5JztcblxuZXhwb3J0IGNsYXNzIEFnZ3JlZ2F0ZURlZmluaXRpb25Jbml0aWFsaXplcjxJIGV4dGVuZHMgQWdncmVnYXRlSWQsIEEgZXh0ZW5kcyBBZ2dyZWdhdGVSb290PEk+PiB7XG5cblx0cHJpdmF0ZSByZWFkb25seSBhZ2dyZWdhdGVGYWN0b3J5QXJjaGl2ZTogQWdncmVnYXRlRmFjdG9yeUFyY2hpdmU8SSwgQT4gPSBDb3JlQ29udGFpbmVyLnJlc29sdmUoQWdncmVnYXRlRmFjdG9yeUFyY2hpdmUpO1xuXG5cdHByaXZhdGUgcmVhZG9ubHkgYWdncmVnYXRlUmVwb3NpdG9yeUFyY2hpdmU6IEFnZ3JlZ2F0ZVJlcG9zaXRvcnlBcmNoaXZlPEksIEE+ID0gQ29yZUNvbnRhaW5lci5yZXNvbHZlKEFnZ3JlZ2F0ZVJlcG9zaXRvcnlBcmNoaXZlKTtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0fVxuXG5cdHJlZ2lzdGVyKFxuXHRcdGRlZmluZWRBZ2dyZWdhdGU6IEFycmF5PEFnZ3JlZ2F0ZURlZmluaXRpb248SSwgQT4+XG5cdCk6IHZvaWQge1xuXG5cdFx0aWYgKGRlZmluZWRBZ2dyZWdhdGUpIHtcblxuXHRcdFx0Y29uc3Qgc2V0ID0gbmV3IFNldCgpO1xuXHRcdFx0Y29uc3QgZmlsdGVyZWREZWZpbml0aW9uczogQXJyYXk8QWdncmVnYXRlRGVmaW5pdGlvbjxJLCBBPj4gPSBbXTtcblxuXHRcdFx0ZGVmaW5lZEFnZ3JlZ2F0ZS5maWx0ZXIoKGRlZjogQWdncmVnYXRlRGVmaW5pdGlvbjxJLCBBPikgPT4ge1xuXHRcdFx0XHRpZiAoIXNldC5oYXMoZGVmLmtleSkpIHtcblx0XHRcdFx0XHRzZXQuYWRkKGRlZi5rZXkpO1xuXHRcdFx0XHRcdGZpbHRlcmVkRGVmaW5pdGlvbnMucHVzaChkZWYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZmlsdGVyZWREZWZpbml0aW9ucy5mb3JFYWNoKChkZWY6IEFnZ3JlZ2F0ZURlZmluaXRpb248SSwgQT4pID0+IHtcblxuXHRcdFx0XHRjb25zdCBmYWN0b3J5ID0gQ29yZUNvbnRhaW5lci5yZXNvbHZlPEFnZ3JlZ2F0ZUZhY3Rvcnk8SSwgQT4+KGRlZi5mYWN0b3J5IGFzIGFueSksXG5cdFx0XHRcdFx0cmVwb3NpdG9yeSA9IENvcmVDb250YWluZXIucmVzb2x2ZTxBZ2dyZWdhdGVSZXBvc2l0b3J5PEksIEE+PigoZGVmLnJlcG9zaXRvcnkgYXMgYW55KSk7XG5cblx0XHRcdFx0aWYgKCF0aGlzLmFnZ3JlZ2F0ZUZhY3RvcnlBcmNoaXZlLmhhcyhkZWYua2V5KSkge1xuXHRcdFx0XHRcdHRoaXMuYWdncmVnYXRlRmFjdG9yeUFyY2hpdmUuYWRkKGRlZi5rZXksIGZhY3RvcnkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCF0aGlzLmFnZ3JlZ2F0ZVJlcG9zaXRvcnlBcmNoaXZlLmhhcyhkZWYua2V5KSkge1xuXHRcdFx0XHRcdHRoaXMuYWdncmVnYXRlUmVwb3NpdG9yeUFyY2hpdmUuYWRkKGRlZi5rZXksIHJlcG9zaXRvcnkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gY29uc29sZS5sb2coJ1JlZ2lzdGVyZWQgYWdncmVnYXRlIGRlZmluaXRpb246JyArIGZpbHRlcmVkRGVmaW5pdGlvbnMubGVuZ3RoKTtcblx0XHRcdC8vIGNvbnNvbGUubG9nKCdSZWdpc3RlcmVkIGFnZ3JlZ2F0ZSBkZWZpbml0aW9uOicsIGZpbHRlcmVkRGVmaW5pdGlvbnMpO1xuXHRcdH1cblx0fVxuXG59XG4iXX0=