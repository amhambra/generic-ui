!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@generic-ui/hermes",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],e):e(((t=t||self)["generic-ui"]=t["generic-ui"]||{},t["generic-ui"].hermes={}),t.ng.core,t.ng.common,t.rxjs,t.rxjs.operators)}(this,(function(t,e,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function u(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}var p=function(){function t(){}return t.prototype.setDomain=function(t){this.domainName=t},t.prototype.log=function(t){this.shouldPrint(t)&&this.print(t)},t.prototype.shouldPrint=function(t){return!this.domainName||t.toString().includes(this.domainName)},t}();var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(p),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(p),h=function(){function t(t,e,r){if(this.platformId=t,this.commandLogger=e,this.eventLogger=r,n.isPlatformBrowser(this.platformId)){window.hermesApi=function(t){return{set loggers(e){e?(t.commandLogger.start(),t.eventLogger.start()):(t.commandLogger.stop(),t.eventLogger.stop())},set domain(e){e&&(t.commandLogger.setDomain(e),t.eventLogger.setDomain(e))}}}(this),window.hermesApi.loggers=!1}}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]},{type:f},{type:l}]},t}();var y="HERMES - DOMAIN_EVENT_HANDLERS_TOKEN";var g=function(){function t(t,e){this.closed=!1,this.finalize=function(){},null!=t&&"function"==typeof t&&(this.finalize=t),null!=e&&(this.closed=e)}return t.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this.finalize())},t.prototype.getFinalize=function(){return this.finalize},t}();var d=function(){function t(t){this.finalize=function(){},this.completed=!1,this.closed=!1,this.observer=t}return t.prototype.next=function(t){this.isCompleted()||this.observer&&this.observer.next&&this.observer.next(t)},t.prototype.error=function(t){this.completed||(this.observer&&this.observer.error&&this.observer.error(t),this.unsubscribe())},t.prototype.complete=function(){this.completed||(this.completed=!0,this.observer&&this.observer.complete&&this.observer.complete(),this.unsubscribe())},t.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this.completed=!0,this.finalize())},t.prototype.setFinalize=function(t){t&&"function"==typeof t&&(this.finalize=t)},t.prototype.isCompleted=function(){return this.completed},t.prototype.isClosed=function(){return this.closed},t.prototype.getObserver=function(){return this.observer},t}();var v=function(){function t(t){this.generatorFn=t}return t.prototype.pipe=function(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];this.source=this;try{for(var o=u(n),i=o.next();!i.done;i=o.next()){var s=i.value;this.source=this.innerPipe(s,this.source)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return this.source},t.prototype.innerPipe=function(t,e){return t(e)},t.prototype.subscribe=function(t){var e;if(t instanceof d)e=t;else if(null!==t&&this.isObserver(t)){var n=t.next,r=t.error,o=t.complete;e=this.createSubscriber(n,r,o)}else e=this.createSubscriber(arguments[0],arguments[1],arguments[2]);return this.generatorFn&&(this.generatorFinalize=this.generatorFn(e),e.setFinalize(this.generatorFinalize)),this.getSubscription()},t.prototype.createSubscriber=function(t,e,n){return new d({next:t,error:e,complete:n})},t.prototype.getSubscription=function(){return new g(this.generatorFinalize)},t.prototype.isObserver=function(t){return"object"==typeof t},t}();function m(){return new g((function(){}),!0)}var b=function(t){function e(){var e=t.call(this)||this;return e.thrownError=null,e.isCompleted=!1,e.isClosed=!1,e.subscribers=[],e}return s(e,t),e.prototype.next=function(t){var e,n;if(this.verifyNotClosed(),!this.isCompleted&&null===this.thrownError)try{for(var r=u(this.subscribers),o=r.next();!o.done;o=r.next()){o.value.next(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.prototype.error=function(t){var e,n;if(this.verifyNotClosed(),!this.isCompleted){this.thrownError=t;try{for(var r=u(this.subscribers),o=r.next();!o.done;o=r.next()){o.value.error(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this.subscribers.length=0}},e.prototype.complete=function(){var t,e;if(this.verifyNotClosed(),!this.isCompleted){this.isCompleted=!0;try{for(var n=u(this.subscribers),r=n.next();!r.done;r=n.next()){r.value.complete()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.subscribers.length=0}},e.prototype.subscribe=function(t){var e;return this.verifyNotClosed(),e=t instanceof d?t:this.createSubscriber(arguments[0],arguments[1],arguments[2]),null!==this.thrownError?(e.error(this.thrownError),m()):this.isCompleted?(e.complete(),m()):(this.subscribers.push(e),this.getSubscription())},e.prototype.unsubscribe=function(){this.isCompleted=!0,this.isClosed=!0,this.subscribers.length=0},e.prototype.toObservable=function(){var t=this;return new v((function(e){var n=t.subscribe((function(t){return e.next(t)}),(function(t){return e.error(t)}),(function(){return e.complete()}));return function(){return n.unsubscribe()}}))},e.prototype.verifyNotClosed=function(){if(this.isClosed)throw new Error("Observable already closed")},e}(v);var E=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return s(n,t),n.decorators=[{type:e.Injectable}],n}(b),I=function(){function t(t){this.commandStream=t}return t.prototype.dispatch=function(t){this.commandStream.next(t)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:E}]},t}();var A=function(){function t(){}return t.generate=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+""+t.index++},t.index=0,t.decorators=[{type:e.Injectable}],t}();var S=function(){function t(t,e,n){void 0===n&&(n=A.generate()),this.aggregateId=t,this.messageType=e,this.messageId=n}return t.prototype.getMessageType=function(){return this.messageType},t.prototype.getAggregateId=function(){return this.aggregateId},t.prototype.getMessageId=function(){return this.messageId},t.prototype.toString=function(){return this.messageType},t.prototype.equalsByType=function(t){return this.getMessageType()===t.getMessageType()},t.prototype.equals=function(t){return this.getMessageType()===t.getMessageType()&&this.messageId===t.messageId},t.prototype.ofMessageType=function(t){var e=this;return Array.isArray(t)?!!t.find((function(t){return e.isMessageType(t)})):this.isMessageType(t)},t.prototype.isMessageType=function(t){return this.getMessageType()===t},t}();var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(S),w=Function,C=w,T=function(){};var M=new e.InjectionToken("FILTERED_COMMAND_STREAM");function O(t,e,n){return new d({next:e||function(e){t.next(e)},error:function(e){return t.error(e)},complete:n||function(){t.complete()}})}function H(t){return function(e){return new v((function(n){var r=O(n,(function(e){t(e)&&n.next(e)}));return e.subscribe(r).getFinalize()}))}}var D=function(t){function n(e){var n=t.call(this)||this;return n.commandsStream=e,n}return s(n,t),n.prototype.subscribe=function(t){return this.commandsStream.toObservable().subscribe(arguments[0],arguments[1],arguments[2])},n.prototype.ofCommand=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.commandsStream.toObservable().pipe(H((function(e){return t.some((function(t){return e.ofMessageType(t)}))})))},n.prototype.ofCommandHandler=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.commandsStream.toObservable().pipe(H((function(e){return t.some((function(t){return t.forCommand(e)}))})))},n.prototype.ofCreateAggregateHandler=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.commandsStream.toObservable().pipe(H((function(e){return t.some((function(t){return t.forCommand(e)}))})))},n.prototype.ofNullHandler=function(t,e){return this.commandsStream.toObservable().pipe(H((function(n){if(!t&&!e)return!0;var r=!0;return t&&(r=!t.some((function(t){return t.forCommand(n)}))),e&&(r=r&&!e.some((function(t){return t.forCommand(n)}))),r})))},n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:E,decorators:[{type:e.Inject,args:[M]}]}]},n}(v);var R=function(){function t(t,e){this.aggregateId=t,this.type=e}return t.prototype.getAggregateId=function(){return this.aggregateId},t.prototype.getType=function(){return this.type},t.prototype.equals=function(t){return this.equalsByType(t)&&this.getAggregateId().equals(t.getAggregateId())},t.prototype.equalsByType=function(t){return this.getType()===t.getType()},t}();var j=w,N=function(){};var P=function(){};var L=function(){function t(){this.stores=[]}return t.prototype.register=function(t){this.stores.push(t)},t.prototype.captureAggregatesSnapshot=function(t){if(!t)return{};var e={};return this.stores.forEach((function(n){var r=n.findById(t);if(r){var o=r.constructor.name;e[o]=r}})),this.cloneAggregates(e)},t.prototype.cloneAggregates=function(t){return t},t}();var _=function(){function t(t,e){this.type=e,this.aggregateId=t,this.events=[]}return t.prototype.getId=function(){return this.aggregateId},t.prototype.getType=function(){return this.type},t.prototype.getEvents=function(){return this.events},t.prototype.addEvent=function(t){var e,n;if(Array.isArray(t))try{for(var r=u(t),o=r.next();!o.done;o=r.next()){var i=o.value;this.events.push(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}else this.events.push(t)},t.prototype.clearEvents=function(){this.events.length=0},t.prototype.equals=function(t){return t.getId().toString()===this.getId().toString()},t}();var B=function(){function t(t){this.uid=t}return t.prototype.getId=function(){return this.uid},t.prototype.equals=function(t){return this.uid===t.getId()},t}();var F=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e.prototype.toString=function(){return t.prototype.getId.call(this)},e}(B);var z=function(t){function e(e,n,r){var o=t.call(this,e,r)||this;return o.payload=n,o}return s(e,t),e.prototype.isSameType=function(t){return this.constructor.name===t.constructor.name},e.prototype.getPayload=function(){return this.payload},e}(S);function k(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new v((function(e){t.forEach((function(t){e.next(t)})),e.complete()}))}function G(){return new v((function(t){t.complete()}))}function V(t){return function(e){return 0===t?G():new v((function(n){var r=0,o=new d({next:function(t){},error:function(t){return n.error(t)},complete:function(){return n.complete()}});return o.observer.next=function(e){r<t&&(n.next(e),++r===t&&o.complete())},e.subscribe(o).getFinalize()}))}}var U=function(){function t(){this.domainEvents=[],this.domainEvents$=new b}return t.prototype.next=function(t){this.domainEvents.push(t),this.domainEvents$.next(t)},t.prototype.findEventByType=function(t){return this.getEvents().reverse().find((function(e){return e.constructor.name===t}))},t.prototype.waitForEvent=function(t){var e=this.findEventByType(t);return e?k(e):this.waitForNextEventOccurrence(t)},t.prototype.waitForNextEventOccurrence=function(t){var e;if(t instanceof z)e=t.constructor.name;else{if("string"!=typeof t)return new v((function(t){t.error(new Error("Unsupported argument type."))}));e=t}return this.domainEvents$.toObservable().pipe(H((function(t){return t.constructor.name===e})),V(1))},t.prototype.getEvents=function(){return this.domainEvents},t.decorators=[{type:e.Injectable}],t}();var q=function(t){function n(e){var n=t.call(this)||this;return n.eventStore=e,n}return s(n,t),n.prototype.next=function(e){t.prototype.next.call(this,e),this.eventStore.next(e)},n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:U}]},n}(b);var $=function(){function t(t){this.eventStream=t}return t.prototype.publish=function(t){var e,n;if(Array.isArray(t))try{for(var r=u(t),o=r.next();!o.done;o=r.next()){var i=o.value;this.publishEvent(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}else t instanceof z&&this.publishEvent(t)},t.prototype.publishFromAggregate=function(t){var e=this;t.getEvents().forEach((function(t){e.publish(t.toDomainEvent())}))},t.prototype.publishEvent=function(t){t||console.error(t+" is not defined"),t instanceof z||console.error(t+" is not a DomainEvent"),this.eventStream.next(t)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:q}]},t}();var K=function(t){function n(e){var n=t.call(this)||this;return n.eventStream=e,n}return s(n,t),n.prototype.subscribe=function(t){return this.eventStream.toObservable().subscribe(arguments[0],arguments[1],arguments[2])},n.prototype.ofEvent=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this.eventStream.toObservable().pipe(H((function(n){return e.some((function(e){return t.createEventInstance(e).equalsByType(n)}))})))},n.prototype.ofEventHandler=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.eventStream.toObservable().pipe(H((function(e){return t.some((function(t){return t.forEvents([e])}))})))},n.prototype.createEventInstance=function(t){var e=[],n=t.constructor.length;return e.fill(void 0,0,n),new(t.bind.apply(t,c([void 0],e)))},n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:q}]},n}(v);var W=w;function J(t){return function(e){return new v((function(n){var r=function(t){return new d({next:function(e){return t.next(e)},error:function(e){return t.error(e)},complete:function(){return t.complete()}})}(n),o=new d({next:function(){return r.complete()}});return t.subscribe(o),e.subscribe(r).getFinalize()}))}}function Y(t){return new r.Observable((function(e){var n=t.subscribe((function(t){return e.next(t)}),(function(t){return e.error(t)}),(function(){return e.complete()}));return function(){return n.unsubscribe()}}))}var Q=function(){function t(){this.hermesUnsubscribe$=new b}return t.prototype.ngOnDestroy=function(){this.hermesUnsubscribe()},t.prototype.takeUntil=function(){return o.takeUntil(Y(this.hermesUnsubscribe$))},t.prototype.hermesUnsubscribe=function(){this.hermesUnsubscribe$.next(),this.hermesUnsubscribe$.complete()},t.prototype.hermesTakeUntil=function(){return J(this.hermesUnsubscribe$)},t.prototype.isNotStopped=function(){return!this.hermesUnsubscribe$.isCompleted},t}();var X=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.ngOnDestroy=function(){this.hermesUnsubscribe()},e}(Q),Z=function(){function t(e){return t.isValueEmpty(e)?this.value=null:this.value=e,this}return t.empty=function(){return new t(null)},t.of=function(e){return new t(e)},t.isValueEmpty=function(t){return null==t},t.prototype.isEmpty=function(){return t.isValueEmpty(this.value)},t.prototype.isPresent=function(){return!this.isEmpty()},t.prototype.filter=function(e){return this.isPresent()&&e(this.value)?this:t.empty()},t.prototype.forEach=function(t){this.isPresent()&&t(this.value)},t.prototype.map=function(e){return this.isPresent()?new t(e(this.value)):t.empty()},t.prototype.getValueOrNullOrThrowError=function(){return this.value},t.prototype.getOrThrow=function(){if(this.isEmpty())throw new Error("Called getOrThrow on an empty Optional");return this.value},t.prototype.getOrElse=function(t){return this.isPresent()?this.value:t()},t.prototype.ifPresent=function(t){this.isPresent()&&t(this.value)},t.prototype.ifEmpty=function(t){this.isEmpty()&&t()},t.prototype.orElse=function(t){return this.isPresent()?this:t()},t}();var tt=function(){function t(){this.keys=new Map,this.values=new WeakMap}return t.prototype.get=function(t){var e=this.getInternalKey(t);return void 0!==e?Z.of(this.values.get(e)):Z.empty()},t.prototype.has=function(t){var e=this.getInternalKey(t);return this.values.has(e)},t.prototype.set=function(t,e){this.keys.set(t.toString(),t),this.values.set(t,e)},t.prototype.size=function(){return this.keys.size},t.prototype.remove=function(t){this.hasInternalKey(t)&&(this.keys.delete(t.toString()),this.values.delete(t))},t.prototype.removeAll=function(){var t=this;this.keys.forEach((function(e){t.values.delete(e)})),this.keys.clear()},t.prototype.getInternalKey=function(t){return this.keys.get(t.toString())},t.prototype.hasInternalKey=function(t){return this.keys.has(t.toString())},t}();function et(t){return function(e){return new v((function(n){var r=0,o=O(n,(function(e){n.next(t(e,r++))}));return e.subscribe(o).getFinalize()}))}}function nt(t){var e=t||rt;return function(t){return new v((function(n){var r=null,o=O(n,(function(t){null!==r&&e(r,t)||(r=t,n.next(t))}));return t.subscribe(o).getFinalize()}))}}function rt(t,e){return t===e}var ot=function(t){function e(e){var n=t.call(this)||this;return n.lastValue=e,n}return s(e,t),e.prototype.next=function(e){this.lastValue=e,t.prototype.next.call(this,e)},e.prototype.subscribe=function(e){var n=t.prototype.subscribe.call(this,arguments[0],arguments[1],arguments[2]);return t.prototype.next.call(this,this.lastValue),n},e}(b);var st=function(t){function e(e){void 0===e&&(e=1);var n=t.call(this)||this;return n.bufferSize=e,n.values=[],n}return s(e,t),e.prototype.next=function(e){this.values.push(e),this.bufferSize<this.values.length&&this.values.shift(),t.prototype.next.call(this,e)},e.prototype.subscribe=function(e){var n,r,o;o=e instanceof d?e:this.createSubscriber(arguments[0],arguments[1],arguments[2]);var i=t.prototype.subscribe.call(this,o);try{for(var s=u(this.values),a=s.next();!a.done;a=s.next()){var c=a.value;o.next(c)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},e}(b);var ut=function(t){function e(){return t.call(this)||this}return s(e,t),e.of=function(t){return void 0!==t?new ot(t):new st(1)},e}(b),at=function(t){function e(e){var n=t.call(this)||this;return n.archive=new tt,n.defaultValue=Z.empty(),n.archive$=ut.of(),null!=e&&(n.defaultValue=Z.of(e)),n}return s(e,t),e.prototype.on=function(t){var e=this;return this.tryToInitDefault(t),this.archive$.toObservable().pipe(H((function(){return e.isNotStopped()})),et((function(e){return e.get(t)})),H((function(t){return t.isPresent()})),et((function(t){return t.getValueOrNullOrThrowError()})),nt(),this.hermesTakeUntil())},e.prototype.once=function(t){return this.on(t).pipe(V(1))},e.prototype.get=function(t){return this.tryToInitDefault(t),this.archive.get(t)},e.prototype.next=function(t,e){this.archive.set(t,e),this.archive$.next(this.archive)},e.prototype.tryToInitDefault=function(t){var e=this;this.defaultValue.ifPresent((function(n){e.archive.has(t)||e.next(t,n)}))},e}(X);var ct=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e}(at),pt=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e.prototype.handle=function(t){this.next(t.getAggregateId(),t.getPayload())},e}(ct);var ft=function(){function t(t){this.entityId=t}return t.prototype.getId=function(){return this.entityId},t}();var lt=function(){function t(t){this.uid=t}return t.prototype.toString=function(){return this.uid},t.prototype.getId=function(){return this.uid},t.prototype.equals=function(t){return this.uid===t.getId()},t}();var ht=function(){function t(t){this.rootId=t}return t.prototype.getId=function(){return this.rootId},t}();var yt=function(){function t(t){this.uid=t}return t.prototype.toString=function(){return this.uid},t.prototype.getId=function(){return this.uid},t.prototype.equals=function(t){return this.uid===t.getId()},t}();var gt=function(t){function e(e){var n=t.call(this)||this;return e.ofEvent.apply(e,c(n.forEvents())).pipe(n.hermesTakeUntil()).subscribe((function(t){try{n.subscribe(t)}catch(t){console.error(t)}})),n}return s(e,t),e}(Q);var dt=function(){};var vt=function(t){function e(e){var n=t.call(this)||this;return n.domainEventBus=e,n}return s(e,t),e.prototype.onEvent=function(t,e){return this.domainEventBus.ofEvent(e).pipe(H((function(e){return e.getAggregateId().toString()===t.toString()})))},e}(X);var mt=function(){function t(t){this.entityId=t}return t.prototype.getId=function(){return this.entityId},t.prototype.equals=function(t){return this.entityId.equals(t.getId())},t}();var bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(B);var Et=function(){},It=function(){},At=function(){};var St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.next=function(t){if(!this.isCompleted()){var e=this.getObserver();e&&e.next&&(e.next(t),this.complete())}},e}(d),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.createSubscriber=function(t,e,n){return new St({next:t,error:e,complete:n})},e}(v);var wt=function(){function t(t){this.archive$=ut.of(t)}return t.prototype.on=function(){return this.archive$.toObservable().pipe(nt(this.compare))},t.prototype.next=function(t){this.archive$.next(t)},t.prototype.compare=function(t,e){return t===e},t}();var Ct=function(){function t(t){this.readModelRootId=t}return t.prototype.getReadModelRootId=function(){return this.readModelRootId},t.prototype.getId=function(){return this.getReadModelRootId().toString()},t}();var Tt=function(){function t(){this.state=new Map}return t.prototype.set=function(t){this.state.set(t.getId(),t)},t.prototype.setMany=function(t){var e=this;t.forEach((function(t){e.set(t)}))},t.prototype.get=function(t){return Z.of(this.state.get(t.toString()))},t.prototype.getAll=function(){return Array.from(this.state.values())},t.prototype.clear=function(){this.state.clear()},t}();var Mt=function(t){function e(e){var n=t.call(this)||this;return n.stateStore=e,n}return s(e,t),e.prototype.getById=function(t){return this.getValue(t)},e.prototype.getAll=function(){return this.getAllValues()},e.prototype.getAllValues=function(){var t=this;return this.stateStore.getAll().map((function(e){return t.toReadModel(e)}))},e.prototype.getValue=function(t){return this.stateStore.get(t).map(this.toReadModel)},e}(dt);var Ot=function(t){function e(e,n){var r=t.call(this)||this;return r.stateStore=e,r.aggregateStoreRegister=n,r.aggregateStoreRegister.register(r),r}return s(e,t),e.prototype.save=function(t){this.saveValue(t)},e.prototype.findById=function(t){return this.getValue(t)},e.prototype.saveValue=function(t){var e=this.toAnemia(t);this.stateStore.set(e)},e.prototype.getValue=function(t){return this.stateStore.get(t).map(this.fromAnemia)},e}(P);var Ht=function(t){function e(e,n){var r=t.call(this)||this;return r.inMemoryStore=e,r.aggregateStoreRegister=n,r.aggregateStoreRegister.register(r),r}return s(e,t),e.prototype.save=function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){e.inMemoryStore.set(t)}));else{var n=t;this.inMemoryStore.set(n)}},e.prototype.findById=function(t){var e=this.inMemoryStore.get(t);return e.ifPresent((function(t){return t.clearEvents()})),e},e.prototype.remove=function(t){this.inMemoryStore.delete(t)},e}(P);var Dt=function(t){function e(e){var n=t.call(this)||this;return n.inMemoryStore=e,n}return s(e,t),e.prototype.getById=function(t){return this.getValue(t)},e.prototype.getValue=function(t){return this.inMemoryStore.get(t).map(this.toReadModel.bind(this))},e}(dt);var Rt=function(){function t(){this.state=new Map}return t.prototype.set=function(t){this.state.set(t.getId().toString(),t)},t.prototype.setMany=function(t){var e=this;t.forEach((function(t){e.set(t)}))},t.prototype.get=function(t){return Z.of(this.state.get(t.toString()))},t.prototype.getAll=function(){return Array.from(this.state.values()).map((function(t){return Z.of(t)}))},t.prototype.has=function(t){return this.state.has(t.toString())},t.prototype.delete=function(t){this.state.delete(t.toString())},t.prototype.clear=function(){this.state.clear()},t}();var jt=function(t){function n(e){var n=t.call(this)||this;return n.enabled=!1,n.unsubscribe$=new b,e.pipe(H((function(){return n.enabled})),J(n.unsubscribe$)).subscribe((function(t){n.log(t)})),n}return s(n,t),n.prototype.ngOnDestroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete()},n.prototype.start=function(){this.enabled=!0},n.prototype.stop=function(){this.enabled=!1},n.prototype.print=function(t){console.log(t.toString(),t)},n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:D}]},n}(f);var Nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.start=function(){},e.prototype.stop=function(){},e.prototype.print=function(t){},e}(f),Pt=function(t){function n(e,n){var r=t.call(this)||this;return r.aggregateStoreRegister=n,r.enabled=!1,r.unsubscribe$=new b,e.pipe(H((function(){return r.enabled})),J(r.unsubscribe$)).subscribe((function(t){r.log(t)})),r}return s(n,t),n.prototype.ngOnDestroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete()},n.prototype.start=function(){this.enabled=!0},n.prototype.stop=function(){this.enabled=!1},n.prototype.print=function(t){var e=t.getAggregateId(),n=this.aggregateStoreRegister.captureAggregatesSnapshot(e);console.log(t.toString(),t,n)},n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:K},{type:L}]},n}(l);var Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.start=function(){},e.prototype.stop=function(){},e.prototype.print=function(t){},e}(l),_t=function(){function t(t,e,n){this.platformId=t,this.commandLogger=e,this.eventLogger=n}return t.prototype.start=function(){this.loggersStart()},t.prototype.stop=function(){this.loggersStop()},t.prototype.loggersStart=function(){n.isPlatformBrowser(this.platformId)&&(this.commandLogger.start(),this.eventLogger.start())},t.prototype.loggersStop=function(){n.isPlatformBrowser(this.platformId)&&(this.commandLogger.stop(),this.eventLogger.stop())},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]},{type:f},{type:l}]},t}();function Bt(t,e,n,r,o){return new Ft(t,e,n,r,o)}var Ft=function(){function t(t,e,n,r,o){this.createAggregateCommandHandler=t,this.aggregateFactoryArchive=e,this.aggregateRepositoryArchive=n,this.aggregateType=r,this.domainEventPublisher=o,this.commandType=this.createCommandInstance().getMessageType()}return t.prototype.handleCommand=function(t){var e=this,n=t.getAggregateId();this.aggregateFactoryArchive.get(this.aggregateType).ifPresent((function(t){var r=t.create(n),o=r.getType(),i=new(r.createEvent())(n,o);r.addEvent(i),e.aggregateRepositoryArchive.get(e.aggregateType).ifPresent((function(t){t.save(r),e.domainEventPublisher.publishFromAggregate(r)}))}))},t.prototype.forCommand=function(t){return this.commandType===t.getMessageType()},t.prototype.createCommandInstance=function(){var t,e=[],n=this.createAggregateCommandHandler.forCommand().constructor.length;return e.fill(void 0,0,n),new((t=this.createAggregateCommandHandler.forCommand()).bind.apply(t,c([void 0],e)))},t}();var zt=function(){function t(){this.map=new Map}return t.prototype.add=function(t,e){this.map.set(t,e)},t.prototype.get=function(t){return Z.of(this.map.get(t))},t.prototype.has=function(t){return this.map.has(t)},t}();var kt=function(){function t(){this.map=new Map}return t.prototype.add=function(t,e){this.map.set(t,e)},t.prototype.get=function(t){return Z.of(this.map.get(t))},t.prototype.has=function(t){return this.map.has(t)},t}();var Gt=function(){function t(){}return t.prototype.ngOnDestroy=function(){},t.decorators=[{type:e.NgModule,args:[{}]}],t}(),Vt="HERMES - COMMAND_HANDLERS_TOKEN";function Ut(t,e,n){return new qt(t,e,n)}var qt=function(){function t(t,e,n){this.commandHandler=t,this.aggregateRepositoryArchive=e,this.aggregateType=n,this.commandType=this.createCommandInstance().getMessageType()}return t.prototype.publishDomainEvents=function(t,e){this.commandHandler.publish(t,e)},t.prototype.handleCommand=function(t){var e=this,n=t.getAggregateId();this.aggregateRepositoryArchive.get(this.aggregateType).ifPresent((function(r){r.findById(n).ifPresent((function(n){e.commandHandler.handle(n,t),e.publishDomainEvents(n,t)}))}))},t.prototype.forCommand=function(t){return this.commandType===t.getMessageType()},t.prototype.createCommandInstance=function(){var t,e=[],n=this.commandHandler.forCommand().constructor.length;return e.fill(void 0,0,n),new((t=this.commandHandler.forCommand()).bind.apply(t,c([void 0],e)))},t}();function $t(t){return new Wt(t,[t.forEvent()])}function Kt(t){return new Wt(t,t.forEvents())}var Wt=function(){function t(t,e){this.domainEventHandler=t,this.events=e,this.eventTypes=this.createDomainEventTypes()}return t.prototype.handleEvent=function(t){this.domainEventHandler.handle(t)},t.prototype.forEvents=function(t){var e=this;return t.some((function(t){return e.eventTypes.some((function(e){return e===t.getMessageType()}))}))},t.prototype.createDomainEventTypes=function(){var t,e,n=[];try{for(var r=u(this.events),o=r.next();!o.done;o=r.next()){var i=o.value,s=this.createDomainEventInstance(i);n.push(s.getMessageType())}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.createDomainEventInstance=function(t){var e=[],n=t.constructor.length;return e.fill(void 0,0,n),new(t.bind.apply(t,c([void 0],e)))},t}();var Jt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.init=function(t,e){var n=this;if(t){var r=new Set,o=[];t.filter((function(t){r.has(t.domainEventHandler)||(r.add(t.domainEventHandler),o.push(t))})),o.forEach((function(t){e.ofEventHandler(t).pipe(n.hermesTakeUntil()).subscribe((function(e){t.handleEvent(e)}))}))}},e}(Q),Yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.register=function(t,e){var n=this;if(t){var r=new Set,o=[];t.filter((function(t){r.has(t.commandHandler)||(r.add(t.commandHandler),o.push(t))})),o.forEach((function(t){e.ofCommandHandler(t).pipe(n.hermesTakeUntil()).subscribe((function(e){t.handleCommand(e)}))}))}},e.prototype.registerAggregateCommandHandlers=function(t,e){var n=this;if(t){var r=new Set,o=[];t.filter((function(t){r.has(t.createAggregateCommandHandler)||(r.add(t.createAggregateCommandHandler),o.push(t))})),o.forEach((function(t){e.ofCreateAggregateHandler(t).pipe(n.hermesTakeUntil()).subscribe((function(e){t.handleCommand(e)}))}))}},e}(Q),Qt=function(){function t(){}return t.prototype.register=function(t,e,n,r){if(t){var o=new Set,i=[];t.filter((function(t){o.has(t.key)||(o.add(t.key),i.push(t))})),i.forEach((function(t){var o=e.get(t.factory),i=e.get(t.repository);n.has(t.key)||n.add(t.key,o),r.has(t.key)||r.add(t.key,i)}))}},t}(),Xt=c([{provide:"GUI - EVENT_LOGGER_ENABLED",useValue:!0},{provide:"GUI - COMMAND_LOGGER_ENABLED",useValue:!0},{provide:f,useFactory:Zt,deps:["GUI - COMMAND_LOGGER_ENABLED",jt,Nt]},{provide:l,useFactory:te,deps:["GUI - EVENT_LOGGER_ENABLED",Pt,Lt]},jt,Nt,Lt,Pt,_t,zt,kt],[A,{provide:M,useExisting:E},D,E,I,L,K,q,$,U,h]);function Zt(t,e,n){return t?e:n}function te(t,e,n){return t?e:n}var ee=function(t){function n(e,n,r,o,i,s,u,a,c,p,f){var l=t.call(this)||this;return l.hermesLoggersInitializer=p,l.hermesApi=f,l.aggregateDefinitionInitializer=new Qt,l.commandHandlerInitializer=new Yt,l.domainEventHandlerInitializer=new Jt,l.hermesLoggersInitializer.start(),l.checkNullCommand(a,r,n),l.checkCommandHandlerIsCollection(r),l.checkDomainEventHandlerIsCollection(e),l.aggregateDefinitionInitializer.register(o,i,s,u),l.commandHandlerInitializer.register(r,a),l.commandHandlerInitializer.registerAggregateCommandHandlers(n,a),l.domainEventHandlerInitializer.init(e,c),l}return s(n,t),n.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this.hermesLoggersInitializer.stop(),this.commandHandlerInitializer.ngOnDestroy(),this.domainEventHandlerInitializer.ngOnDestroy()},n.prototype.checkNullCommand=function(t,e,n){t.ofNullHandler(e,n).pipe(this.hermesTakeUntil()).subscribe((function(t){console.error("Command "+t.toString()+" was not intercepted by any CommandHandler.")}))},n.prototype.checkCommandHandlerIsCollection=function(t){t&&!Array.isArray(t)&&console.warn('You might provided commandHandler without specifying "multi: true".')},n.prototype.checkDomainEventHandlerIsCollection=function(t){t&&!Array.isArray(t)&&console.warn('You might provided eventHandler without specifying "multi: true".')},n.ctorParameters=function(){return[{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[y]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:["HERMES - CREATE_AGGREGATE_COMMAND_HANDLERS"]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[Vt]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:["Hermes - aggregateDefinitionToken"]}]},{type:e.Injector},{type:zt},{type:kt},{type:D},{type:K},{type:_t},{type:h}]},n}(Q);var ne=function(t){function r(e,n,r,o,i,s,u,a,c,p,f){return t.call(this,e,n,r,o,i,s,u,a,c,p,f)||this}return s(r,t),r.defineAggregate=function(t,e,n,o,i,s){return void 0===i&&(i=[]),void 0===s&&(s=[]),{ngModule:Gt,providers:c([{provide:"Hermes - aggregateDefinitionToken",multi:!0,useValue:{key:t,factory:e,repository:n}},{provide:t,useValue:t},e,n],r.registerCreateCommandHandler(o,t),i,s)}},r.withConfig=function(t){return void 0===t&&(t={loggers:!1}),{ngModule:r,providers:Xt}},r.registerCommandHandler=function(t,e){return[{provide:t,useClass:t},{provide:Vt,useFactory:Ut,multi:!0,deps:[t,kt,e]}]},r.registerDomainEventHandler=function(t){return[{provide:t,useClass:t},{provide:y,useFactory:$t,multi:!0,deps:[t]}]},r.registerMultiDomainEventHandler=function(t){return[{provide:t,useClass:t},{provide:y,useFactory:Kt,multi:!0,deps:[t]}]},r.registerCreateCommandHandler=function(t,e){return[{provide:t,useClass:t},{provide:"HERMES - CREATE_AGGREGATE_COMMAND_HANDLERS",useFactory:Bt,multi:!0,deps:[t,zt,kt,e,$]}]},r.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],providers:Xt}]}],r.ctorParameters=function(){return[{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[y]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:["HERMES - CREATE_AGGREGATE_COMMAND_HANDLERS"]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[Vt]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:["Hermes - aggregateDefinitionToken"]}]},{type:e.Injector},{type:zt},{type:kt},{type:D},{type:K},{type:_t},{type:h}]},r}(ee);var re=function(t){function e(e,n){return t.call(this,e,n)||this}return s(e,t),e}(x);t.AggregateArchive=ct,t.AggregateEvent=R,t.AggregateEventType=j,t.AggregateFactory=T,t.AggregateId=F,t.AggregateRepository=N,t.AggregateRoot=_,t.AggregateStore=P,t.AggregateStoreRegister=L,t.ApiModule=It,t.Archive=wt,t.COMMAND_LOGGER_ENABLED="GUI - COMMAND_LOGGER_ENABLED",t.Command=x,t.CommandBus=D,t.CommandDispatcher=I,t.CommandLogger=f,t.CommandStream=E,t.CommandType=C,t.CreateAggregateCommand=re,t.DomainEvent=z,t.DomainEventBus=K,t.DomainEventLogger=l,t.DomainEventPublisher=$,t.DomainEventStream=q,t.DomainEventType=W,t.DomainModule=Et,t.DomainObject=function(t){},t.EVENT_LOGGER_ENABLED="GUI - EVENT_LOGGER_ENABLED",t.Entity=mt,t.EntityId=bt,t.EventDrivenRepository=pt,t.EventRepository=vt,t.FeatureModule=At,t.HermesApi=h,t.HermesArchiveSubject=ut,t.HermesBehaviorSubject=ot,t.HermesId=B,t.HermesModule=ne,t.HermesObservable=v,t.HermesReplaySubject=st,t.HermesSingle=xt,t.HermesSubject=b,t.HermesSubscription=g,t.InMemoryAggregateStore=Ht,t.InMemoryReadModelStore=Dt,t.InMemoryStore=Rt,t.KeyMap=tt,t.Optional=Z,t.PersistAggregateStore=Ot,t.PersistAnemia=Ct,t.PersistReadModelStore=Mt,t.PersistStateStore=Tt,t.RandomStringGenerator=A,t.Reactive=Q,t.ReactiveService=X,t.ReadModelEntity=ft,t.ReadModelEntityId=lt,t.ReadModelObject=function(t){},t.ReadModelRoot=ht,t.ReadModelRootId=yt,t.ReadModelRootRepository=gt,t.ReadModelStore=dt,t.ValueObject=function(t){},t.assertAggregateEvents=function(t,e){var n,r;expect(t.length).toEqual(e.length,"Aggregate events");var o=function(t){var n=e.find((function(e){return e.equals(t)}));expect(n).toBeDefined()};try{for(var i=u(t),s=i.next();!s.done;s=i.next()){o(s.value)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.assertDomainEvents=function(t,e){var n,r;expect(t.length).toEqual(e.length);var o=function(t){var n=e.find((function(e){return e.equalsByType(t)}));expect(n).toBeDefined(),expect(t.equalsByType(n)).toBeTruthy(),expect(t.getPayload()).toEqual(n.getPayload(),"Events payload should be the same")};try{for(var i=u(t),s=i.next();!s.done;s=i.next()){o(s.value)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.disableHermesLoggers=function(t){var e=t||window;delete e.hermesApi.domain,e.hermesApi.loggers=!1},t.enableHermesLoggers=function(t,e){var n=e||window;t&&(n.hermesApi.domain=t),n.hermesApi.loggers=!0},t.fromRxJsObservable=function(t){return new v((function(e){var n=t.subscribe((function(t){return e.next(t)}),(function(t){return e.error(t)}),(function(){return e.complete()}));return function(){return n.unsubscribe()}}))},t.hermesDistinctUntilChanged=nt,t.hermesEmpty=G,t.hermesFilter=H,t.hermesFromEvent=function(t,e){return new v((function(n){var r=function(t){n.next(t)};return t.addEventListener(e,r),function(){t.removeEventListener(e,r)}}))},t.hermesInterval=function(t){var e=0;return new v((function(n){var r=setInterval((function(){n.next(e++)}),t);return function(){clearInterval(r),n.complete()}}))},t.hermesMap=et,t.hermesNever=function(){return new v((function(t){}))},t.hermesOf=k,t.hermesSkip=function(t){return function(e){return new v((function(n){var r=0,o=O(n,(function(e){r>=t&&n.next(e),r++}));return e.subscribe(o).getFinalize()}))}},t.hermesSwitchMap=function(t){return function(e){return new v((function(n){var r=!1,o=null,i=function(){r&&!o&&n.complete()},s=O(n,(function(e){o&&o.unsubscribe();var r=new d({next:function(t){return n.next(t)},error:function(t){return n.error(t)},complete:function(){o=null,i()}});return o=r,t(e).subscribe(r).getFinalize()}),(function(){r=!0,i()}));return e.subscribe(s).getFinalize()}))}},t.hermesTake=V,t.hermesTakeUntil=J,t.hermesTap=function(t){return function(e){return new v((function(n){var r=O(n,(function(e){t(e),n.next(e)}));return e.subscribe(r).getFinalize()}))}},t.hermesThrowError=function(t){return new v((function(e){e.error(t)}))},t.hermesTimer=function(t){return new v((function(e){var n=setTimeout((function(){e.next(0)}),t);return function(){clearTimeout(n),e.complete()}}))},t.hermesToArray=function(){return function(t){return new v((function(e){var n=[],r=O(e,(function(t){n.push(t)}),(function(){n.length>0&&e.next(n),e.complete()}));return t.subscribe(r).getFinalize()}))}},t.provideEventHandlers=function(t){return t.map((function(t){return{provide:y,useClass:t,multi:!0}}))},t.singleFromObservable=function(t){return new xt((function(e){var n=new d({next:function(t){return e.next(t)},error:function(t){return e.error(t)},complete:function(){}});return t.subscribe(n).getFinalize()}))},t.testEventRepositoryIsEmptyOnStart=function(t,e){it("should be no "+e+" events on start",(function(){expect.assertions(3);var e=jest.fn(),n=jest.fn(),r=jest.fn();t().subscribe((function(){return e()}),(function(t){return n(t)}),(function(){return r()})),expect(e).not.toHaveBeenCalled(),expect(n).not.toHaveBeenCalled(),expect(r).not.toHaveBeenCalled()}))},t.testWarehouseDefaultValueOnStart=function(t,e,n){it("should have default value "+n,(function(){expect.assertions(4);var n=jest.fn(),r=jest.fn(),o=jest.fn();t().subscribe((function(t){return n(t)}),(function(t){return r(t)}),(function(){return o()})),expect(n).toHaveBeenCalledWith(e),expect(n).toHaveBeenCalledTimes(1),expect(r).not.toHaveBeenCalled(),expect(o).not.toHaveBeenCalled()}))},t.testWarehouseDefaultValueOnStartOnce=function(t,e,n){it("should have default value "+n,(function(){expect.assertions(4);var n=jest.fn(),r=jest.fn(),o=jest.fn();t().subscribe((function(t){return n(t)}),(function(t){return r(t)}),(function(){return o()})),expect(n).toHaveBeenCalledWith(e),expect(n).toHaveBeenCalledTimes(1),expect(r).not.toHaveBeenCalled(),expect(o).toHaveBeenCalledTimes(1)}))},t.toRxJsObservable=Y,t.ɵa=Zt,t.ɵb=te,t.ɵba=Bt,t.ɵbb=Ft,t.ɵc=ee,t.ɵd=p,t.ɵe=S,t.ɵf=M,t.ɵg=U,t.ɵh=at,t.ɵi=y,t.ɵj="HERMES - CREATE_AGGREGATE_COMMAND_HANDLERS",t.ɵk=Vt,t.ɵl="Hermes - aggregateDefinitionToken",t.ɵn=zt,t.ɵo=kt,t.ɵp=_t,t.ɵq=jt,t.ɵr=Nt,t.ɵs=Pt,t.ɵt=Lt,t.ɵu=Gt,t.ɵv=Ut,t.ɵw=qt,t.ɵx=$t,t.ɵy=Kt,t.ɵz=Wt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=generic-ui-hermes.umd.min.js.map