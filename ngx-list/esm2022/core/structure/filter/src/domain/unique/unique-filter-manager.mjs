import { KeyMap } from '@generic-ui/hermes';
import { UniqueValueCollection } from './unique-value-collection';
export class UniqueFilterManager {
    uniqueValueMap = new KeyMap();
    calculate(entities, field) {
        const fieldId = field.getId();
        const optUVM = this.uniqueValueMap.find(fieldId);
        optUVM.ifEmpty(() => {
            const set = new Set();
            for (const entity of entities) {
                set.add(field.getValue(entity));
            }
            // sort
            const sortedValues = Array.from(set.values()).sort((a, b) => {
                return field.getField().sort(a, b);
            });
            const uvc = new UniqueValueCollection(sortedValues, field);
            this.uniqueValueMap.set(field.getId(), uvc);
        });
    }
    calculateAll(entities, fields) {
        for (const field of fields) {
            this.calculate(entities, field);
        }
    }
    filterAll(entities, fields) {
        let values = entities;
        for (const field of fields) {
            values = this.filter(values, field);
        }
        return values;
    }
    filter(entities, field) {
        let values = [];
        this.uniqueValueMap
            .find(field.getId())
            .ifPresent((uvc) => {
            if (uvc.isAllSelected()) {
                values = entities;
            }
            else if (uvc.isAllDisabled()) {
                values = [];
            }
            else {
                values = entities.filter((itemEntity) => {
                    for (const notSelectedValue of uvc.getNotSelected()) {
                        if (field.getField().equals(itemEntity, notSelectedValue.getValue())) {
                            return false;
                        }
                    }
                    return true;
                });
            }
        });
        return values;
    }
    selectAll(fieldId) {
        this.uniqueValueMap
            .find(fieldId)
            .ifPresent((uvc) => {
            uvc.selectAll();
        });
    }
    select(fieldId, uniqueValueId) {
        this.uniqueValueMap
            .find(fieldId)
            .ifPresent((uvc) => {
            uvc.select(uniqueValueId);
        });
    }
    unselectAll(fieldId) {
        this.uniqueValueMap
            .find(fieldId)
            .ifPresent((uvc) => {
            uvc.unselectAll();
        });
    }
    unselect(fieldId, uniqueValueId) {
        this.uniqueValueMap
            .find(fieldId)
            .ifPresent((uvc) => {
            uvc.unselect(uniqueValueId);
        });
    }
    getAll(fields) {
        const map = new Map();
        for (const field of fields) {
            this.getValues(field)
                .ifPresent((v) => {
                map.set(field.getId().toString(), v);
            });
        }
        return map;
    }
    getValues(field) {
        return this.uniqueValueMap
            .find(field.getId())
            .map((uvc) => {
            return uvc.getAll();
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLWZpbHRlci1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vYnVpbGQtY2xpL3Byb2plY3RzL25neC1saXN0L3NyYy9jb3JlL3N0cnVjdHVyZS9maWx0ZXIvc3JjL2RvbWFpbi91bmlxdWUvdW5pcXVlLWZpbHRlci1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQVksTUFBTSxvQkFBb0IsQ0FBQztBQUt0RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUtsRSxNQUFNLE9BQU8sbUJBQW1CO0lBRWQsY0FBYyxHQUFHLElBQUksTUFBTSxFQUFrQyxDQUFDO0lBRS9FLFNBQVMsQ0FBQyxRQUEyQixFQUFFLEtBQWtCO1FBRXhELE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU5QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVqRCxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUVuQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBRXRCLEtBQUssTUFBTSxNQUFNLElBQUksUUFBUSxFQUFFO2dCQUM5QixHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzthQUNoQztZQUVELE9BQU87WUFDUCxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsRUFBRTtnQkFDckUsT0FBUSxLQUFhLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3QyxDQUFD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QUFRLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQTBCO1FBRWhDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7UUFFdEIsS0FBSyxNQUFNLEtBQUssSUFBSSxNQUFNLEVBQUU7WUFFM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7aUJBQ25CLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUNoQixHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0QyxDQUFDLENBQUMsQ0FBQztTQUNKO1FBRUQsT0FBTyxHQUFHLENBQUM7SUFDWixDQUFDO0lBRUQsU0FBUyxDQUFDLEtBQWtCO1FBRTNCLE9BQU8sSUFBSSxDQUFDLGNBQWM7YUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUNuQixHQUFHLENBQUMsQ0FBQyxHQUEwQixFQUFFLEVBQUU7WUFDbkMsT0FBTyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDVCxDQUFDO0NBRUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBLZXlNYXAsIE9wdGlvbmFsIH0gZnJvbSAnQGdlbmVyaWMtdWkvaGVybWVzJztcblxuaW1wb3J0IHsgRmllbGRJZCB9IGZyb20gJy4uLy4uLy4uLy4uL2ZpZWxkL3NyYy9kb21haW4vZmllbGQvZmllbGQuaWQnO1xuaW1wb3J0IHsgSXRlbUVudGl0eSB9IGZyb20gJy4uLy4uLy4uLy4uL3NvdXJjZS9zcmMvZG9tYWluL2l0ZW0vaXRlbS5lbnRpdHknO1xuaW1wb3J0IHsgRmllbGRFbnRpdHkgfSBmcm9tICcuLi8uLi8uLi8uLi9maWVsZC9zcmMvZG9tYWluL2ZpZWxkL2ZpZWxkLmVudGl0eSc7XG5pbXBvcnQgeyBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24gfSBmcm9tICcuL3VuaXF1ZS12YWx1ZS1jb2xsZWN0aW9uJztcbmltcG9ydCB7IFVuaXF1ZVZhbHVlIH0gZnJvbSAnLi91bmlxdWUtdmFsdWUnO1xuaW1wb3J0IHsgVW5pcXVlVmFsdWVJZCB9IGZyb20gJy4vdW5pcXVlLXZhbHVlLWlkJztcblxuXG5leHBvcnQgY2xhc3MgVW5pcXVlRmlsdGVyTWFuYWdlciB7XG5cblx0cHJpdmF0ZSByZWFkb25seSB1bmlxdWVWYWx1ZU1hcCA9IG5ldyBLZXlNYXA8RmllbGRJZCwgVW5pcXVlVmFsdWVDb2xsZWN0aW9uPigpO1xuXG5cdGNhbGN1bGF0ZShlbnRpdGllczogQXJyYXk8SXRlbUVudGl0eT4sIGZpZWxkOiBGaWVsZEVudGl0eSk6IHZvaWQge1xuXG5cdFx0Y29uc3QgZmllbGRJZCA9IGZpZWxkLmdldElkKCk7XG5cblx0XHRjb25zdCBvcHRVVk0gPSB0aGlzLnVuaXF1ZVZhbHVlTWFwLmZpbmQoZmllbGRJZCk7XG5cblx0XHRvcHRVVk0uaWZFbXB0eSgoKSA9PiB7XG5cblx0XHRcdGNvbnN0IHNldCA9IG5ldyBTZXQoKTtcblxuXHRcdFx0Zm9yIChjb25zdCBlbnRpdHkgb2YgZW50aXRpZXMpIHtcblx0XHRcdFx0c2V0LmFkZChmaWVsZC5nZXRWYWx1ZShlbnRpdHkpKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gc29ydFxuXHRcdFx0Y29uc3Qgc29ydGVkVmFsdWVzID0gQXJyYXkuZnJvbShzZXQudmFsdWVzKCkpLnNvcnQoKGE6IGFueSwgYjogYW55KSA9PiB7XG5cdFx0XHRcdHJldHVybiAoZmllbGQgYXMgYW55KS5nZXRGaWVsZCgpLnNvcnQoYSwgYik7XG5cdFx0XHR9KTtcblxuXHRcdFx0Y29uc3QgdXZjID0gbmV3IFVuaXF1ZVZhbHVlQ29sbGVjdGlvbihzb3J0ZWRWYWx1ZXMsIGZpZWxkKTtcblxuXHRcdFx0dGhpcy51bmlxdWVWYWx1ZU1hcC5zZXQoZmllbGQuZ2V0SWQoKSwgdXZjKTtcblx0XHR9KTtcblxuXHR9XG5cblx0Y2FsY3VsYXRlQWxsKGVudGl0aWVzOiBBcnJheTxJdGVtRW50aXR5PiwgZmllbGRzOiBBcnJheTxGaWVsZEVudGl0eT4pOiB2b2lkIHtcblx0XHRmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkcykge1xuXHRcdFx0dGhpcy5jYWxjdWxhdGUoZW50aXRpZXMsIGZpZWxkKTtcblx0XHR9XG5cdH1cblxuXHRmaWx0ZXJBbGwoZW50aXRpZXM6IEFycmF5PEl0ZW1FbnRpdHk+LCBmaWVsZHM6IEFycmF5PEZpZWxkRW50aXR5Pik6IEFycmF5PEl0ZW1FbnRpdHk+IHtcblxuXHRcdGxldCB2YWx1ZXM6IEFycmF5PEl0ZW1FbnRpdHk+ID0gZW50aXRpZXM7XG5cblx0XHRmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkcykge1xuXG5cdFx0XHR2YWx1ZXMgPSB0aGlzLmZpbHRlcih2YWx1ZXMsIGZpZWxkKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsdWVzO1xuXHR9XG5cblx0ZmlsdGVyKGVudGl0aWVzOiBBcnJheTxJdGVtRW50aXR5PiwgZmllbGQ6IEZpZWxkRW50aXR5KTogQXJyYXk8SXRlbUVudGl0eT4ge1xuXG5cdFx0bGV0IHZhbHVlczogQXJyYXk8SXRlbUVudGl0eT4gPSBbXTtcblxuXHRcdHRoaXMudW5pcXVlVmFsdWVNYXBcblx0XHRcdC5maW5kKGZpZWxkLmdldElkKCkpXG5cdFx0XHQuaWZQcmVzZW50KCh1dmM6IFVuaXF1ZVZhbHVlQ29sbGVjdGlvbikgPT4ge1xuXG5cdFx0XHRcdGlmICh1dmMuaXNBbGxTZWxlY3RlZCgpKSB7XG5cdFx0XHRcdFx0dmFsdWVzID0gZW50aXRpZXM7XG5cdFx0XHRcdH0gZWxzZSBpZiAodXZjLmlzQWxsRGlzYWJsZWQoKSkge1xuXHRcdFx0XHRcdHZhbHVlcyA9IFtdO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0dmFsdWVzID0gZW50aXRpZXMuZmlsdGVyKChpdGVtRW50aXR5OiBJdGVtRW50aXR5KSA9PiB7XG5cblx0XHRcdFx0XHRcdGZvciAoY29uc3Qgbm90U2VsZWN0ZWRWYWx1ZSBvZiB1dmMuZ2V0Tm90U2VsZWN0ZWQoKSkge1xuXG5cdFx0XHRcdFx0XHRcdGlmICgoZmllbGQuZ2V0RmllbGQoKSBhcyBhbnkpLmVxdWFscyhpdGVtRW50aXR5LCAobm90U2VsZWN0ZWRWYWx1ZSBhcyBhbnkpLmdldFZhbHVlKCkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0pO1xuXG5cdFx0cmV0dXJuIHZhbHVlcztcblx0fVxuXG5cdHNlbGVjdEFsbChmaWVsZElkOiBGaWVsZElkKTogdm9pZCB7XG5cblx0XHR0aGlzLnVuaXF1ZVZhbHVlTWFwXG5cdFx0XHQuZmluZChmaWVsZElkKVxuXHRcdFx0LmlmUHJlc2VudCgodXZjOiBVbmlxdWVWYWx1ZUNvbGxlY3Rpb24pID0+IHtcblx0XHRcdFx0dXZjLnNlbGVjdEFsbCgpO1xuXHRcdFx0fSk7XG5cdH1cblxuXHRzZWxlY3QoZmllbGRJZDogRmllbGRJZCwgdW5pcXVlVmFsdWVJZDogVW5pcXVlVmFsdWVJZCk6IHZvaWQge1xuXG5cdFx0dGhpcy51bmlxdWVWYWx1ZU1hcFxuXHRcdFx0LmZpbmQoZmllbGRJZClcblx0XHRcdC5pZlByZXNlbnQoKHV2YzogVW5pcXVlVmFsdWVDb2xsZWN0aW9uKSA9PiB7XG5cdFx0XHRcdHV2Yy5zZWxlY3QodW5pcXVlVmFsdWVJZCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHVuc2VsZWN0QWxsKGZpZWxkSWQ6IEZpZWxkSWQpOiB2b2lkIHtcblxuXHRcdHRoaXMudW5pcXVlVmFsdWVNYXBcblx0XHRcdC5maW5kKGZpZWxkSWQpXG5cdFx0XHQuaWZQcmVzZW50KCh1dmM6IFVuaXF1ZVZhbHVlQ29sbGVjdGlvbikgPT4ge1xuXHRcdFx0XHR1dmMudW5zZWxlY3RBbGwoKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0dW5zZWxlY3QoZmllbGRJZDogRmllbGRJZCwgdW5pcXVlVmFsdWVJZDogVW5pcXVlVmFsdWVJZCk6IHZvaWQge1xuXG5cdFx0dGhpcy51bmlxdWVWYWx1ZU1hcFxuXHRcdFx0LmZpbmQoZmllbGRJZClcblx0XHRcdC5pZlByZXNlbnQoKHV2YzogVW5pcXVlVmFsdWVDb2xsZWN0aW9uKSA9PiB7XG5cdFx0XHRcdHV2Yy51bnNlbGVjdCh1bmlxdWVWYWx1ZUlkKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0Z2V0QWxsKGZpZWxkczogQXJyYXk8RmllbGRFbnRpdHk+KTogTWFwPHN0cmluZywgQXJyYXk8VW5pcXVlVmFsdWU+PiB7XG5cblx0XHRjb25zdCBtYXAgPSBuZXcgTWFwKCk7XG5cblx0XHRmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkcykge1xuXG5cdFx0XHR0aGlzLmdldFZhbHVlcyhmaWVsZClcblx0XHRcdFx0LmlmUHJlc2VudCgodikgPT4ge1xuXHRcdFx0XHRcdG1hcC5zZXQoZmllbGQuZ2V0SWQoKS50b1N0cmluZygpLCB2KTtcblx0XHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcDtcblx0fVxuXG5cdGdldFZhbHVlcyhmaWVsZDogRmllbGRFbnRpdHkpOiBPcHRpb25hbDxBcnJheTxVbmlxdWVWYWx1ZT4+IHtcblxuXHRcdHJldHVybiB0aGlzLnVuaXF1ZVZhbHVlTWFwXG5cdFx0XHRcdCAgIC5maW5kKGZpZWxkLmdldElkKCkpXG5cdFx0XHRcdCAgIC5tYXAoKHV2YzogVW5pcXVlVmFsdWVDb2xsZWN0aW9uKSA9PiB7XG5cdFx0XHRcdFx0ICAgcmV0dXJuIHV2Yy5nZXRBbGwoKTtcblx0XHRcdFx0ICAgfSk7XG5cdH1cblxufVxuIl19